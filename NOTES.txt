
16 Nov 2024
===========

The command given was:

```
neerajs@azuli-m1 [ ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson ]$ time ./import-specs-modify-cgmjson.sh fedora sample_pkglist_file inout_cgmanifest.json
```

Therefore, the src.rpms were fetched and extracted as per the list in sample_pkglist_file.
The fedora image used was fedora:41.
The cgmanifest generated was inout_cgmanifest.json.


1482 packages were fetched successfully.

Three files have been generated which give the overall package fetch results, list of successfully fetched packages and the list of packages whose fetch failed.
These files are:
pkg_fetch_result_list
pkg_fetch_success_list
pkg_fetch_fail_list

These were generated with the scripts:

```
neerajs@azuli-m1 [ ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson ]$ for pk in `cat sample_pkglist_file`; do  if [ -d output/fedora/specs/$pk ]; then echo $pk " successfully fetched"; else echo $pk " not fetched"; fi; done > pkg_fetch_result_list
neerajs@azuli-m1 [ ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson ]$ for pk in `cat sample_pkglist_file`; do  if [ -d output/fedora/specs/$pk ]; then echo $pk " successfully fetched"; else echo $pk " not fetched"; fi; done | grep "successfully fetched" > pkg_fetch_success_list
neerajs@azuli-m1 [ ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson ]$ for pk in `cat sample_pkglist_file`; do  if [ -d output/fedora/specs/$pk ]; then echo $pk " successfully fetched"; else echo $pk " not fetched"; fi; done | grep "not fetched" > pkg_fetch_fail_list
neerajs@azuli-m1 [ ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson ]$ 
```


With these output we are trying the build in 

```
/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms

```

Successfully built the tree package using the Mariner 3.0-dev unmodified source.
This confirmed that the build is happening successfully to begin with.


17 Nov 2024
===========

Successfully built the CharLS package from the contents extracted from downloaded src.rpm
and verified that the signature file was also generated.

Note that not all of the packages that were successfully downloaded will be copied into the SPECS-EXTENDED
directory for the build.
The reason is that some packages were moved from SPECS-EXTENDED to SPECS directory when we moved from 
2.0 to 3.0-dev.  These packages are not going to be upgraded in the current exercise, and moreover copying 
their folders into SPECS-EXTENDED will create duplicate spec file situation which is flagged by the build
system as an error.


Determining which of the downloaded package folders will be copied into SPECS-EXTENDED
:
1.    The packages to be moved from SPECS-EXTENDED folder for safe keeping and later cross-checks.
      These were simply the packages that had been successfully downloaded (as captured in the 
      pkg_fetch_result_list) and were also present in the SPECS-EXTENDED folder.    

      a.)    Therefore, moved these directories from the SPECS-EXTENDED folder to 
             "azlinux_sms/SavedMarinerPkg_ORIGINALS"

2.    The packages from the successfully downloaded list that should not be copied into SPECS-EXTENDED
      because those have been placed into the SPECS folder when we transitioned from 2.0 to 3.0-dev.
      These are the packages which will therefore be found in SPECS instead of SPECS-EXTENDED in 
      3.0-dev.

      Accordingly, generated two lists:
      a.    pkg_under_moved_category
      b.    pkg_under_will_try_category

      These were generated by running the following scripts:

```
neerajs@azuli-m1 [ ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson ]$ ./categorize_pkg_list.sh sample_pkglist_file | grep "Moved" > pkg_under_moved_category
neerajs@azuli-m1 [ ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson ]$ ./categorize_pkg_list.sh sample_pkglist_file | grep "Will_try" > pkg_under_will_try_category
```

3.    The files listed in "pkg_under_will_try_category" will be of two types - 
      a.    Those that were found in SPECS-EXTENDED of 3.0-dev.  Those have been labelled as "Will_try_upgrade"
      b.    Those that were not found in either of the two folders SPECS or SPECS-EXTENDED.  Those have been labelled as "Will_try_add"

4.    We will copy folders for those successfully downloaded packages into SPECS-EXTENDED directory
      which fall under the "Will_try_update" or "Will_try_add" categories, i.e. which are captured in
      the file "pkg_under_will_try_category".

5.    For this the script "determine_pkg_to_copy" was used.  The list was generated into the file 
      "pkg_tobecopied_from_dnld_to_SPECS-EXTENDED_list".
      This script misses "dbus-c++" as the package to be copies.  This package we will copy manually from 
      output/fedora/specs to azlinux_sms/SPECS-EXTENDED.  Rest of the packages that will be copied will
      be picked from "pkg_tobecopied_from_dnld_to_SPECS-EXTENDED_list".

      The command given for the generation of "pkg_tobecopied_from_dnld_to_SPECS-EXTENDED_list" was:
```
neerajs@azuli-m1 [ ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson ]$ ./determine_pkg_to_copy  > pkg_tobecopied_from_dnld_to_SPECS-EXTENDED_list
```

The copying was done through a shell command.
The logs of run of this copy operation (command) are captured in the file 
"LOGS_OF_copy_from_dnld_to_EXTENDED.txt".


For building all the packages in the SPECS-EXTENDED directory the modified pkgbld script "modified_pkgbld.sh" was
used.


This failed because two packages "authselect" and "mock" had been copied from the downloaded packages to the SPECS-EXTENDED folder.
The problem is that these packages were already present in the "SPECS" folder.

As a result an error like the following was thrown by the build script:

```
Manifests are the same, not updating pkggen_core_x86_64.txt
/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/srpm_pack.mk:80: *** multiple target patterns.  Stop.
```


The screengrabs showing that these packages are present in both SPECS and SPECS-EXTENDED are follows:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ for pkg in `ls`
> do
> if [ -d ../SPECS/$pkg ]
> then
> echo $pkg " exists in both"
> fi
> done
authselect  exists in both
mock  exists in both
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls -ld authselect*/ mock*/
drwxrwxr-x. 2 neerajs neerajs 4096 Nov 17 09:10 authselect/
drwxrwxr-x. 2 neerajs neerajs 4096 Nov 17 09:10 mock/
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls -ld ../SPECS/authsel*/ ../SPECS/moc*/
drwxrwxr-x. 2 neerajs neerajs 4096 Nov 16 09:28 ../SPECS/authselect/
drwxrwxr-x. 2 neerajs neerajs 4096 Nov 16 09:28 ../SPECS/mock-core-configs/
drwxrwxr-x. 2 neerajs neerajs 4096 Nov 16 09:28 ../SPECS/mock/
```

The correct thing would be that these packages should not have been copied into SPECS-EXTENDED.  These are under the category "Moved".  But somehow these sneaked past our checks.


Did that and retried the build with "modified_pkgbld.sh"

Even after this the above error of "multiple target patterns" at line 80 of "srpm_pack.mk" appeared.

Giving up temporarily on trying to build all the packages in one go.

Instead picked up "CharLS" for build.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ sudo ./customised_make_invoke_forALL.sh
```

where customized_make_invoke_forALL.sh was:

```
./pkgbld.sh -s ../SPECS-EXTENDED -p "CharLS"
```

"rpmssnapshot" tool reports issues with a number of spec files:

```
graph.dot 
INFO[0000][grapher] Finished generating graph.                   
Finished updating /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/INTERMEDIATE_SRPMS
WARN[0010][rpmssnapshot] error: line 61: Illegal char ')' (0x29) in: Requires: openssl >= (none):3.3.2
error: query of specfile /chroot_mnt/freeradius/freeradius.spec failed, can't parse 
ERRO[0010][rpmssnapshot] Failed to generate snapshot from specs folder (../SPECS-EXTENDED) into (/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json). Error: failed to retrieve a list of specs inside (/chroot_mnt):
failed while querrying spec (/chroot_mnt/freeradius/freeradius.spec). Error: failed to query SPEC (/chroot_mnt/freeradius/freeradius.spec):
exit status 1. 
WARN[0010][rpmssnapshot] error: line 65: Versioned file name not permitted: Requires: /usr/bin/python3-lensfun = 0.3.4-2.azl3
error: query of specfile /chroot_mnt/lensfun/lensfun.spec failed, can't parse 
WARN[0010][rpmssnapshot] error: line 71: Unknown tag: %fontpkg -a
error: query of specfile /chroot_mnt/google-noto-emoji-fonts/google-noto-emoji-fonts.spec failed, can't parse 
WARN[0010][rpmssnapshot] error: line 81: Unknown tag: %fontpkg
error: query of specfile /chroot_mnt/ipa-pgothic-fonts/ipa-pgothic-fonts.spec failed, can't parse 
WARN[0010][rpmssnapshot] error: line 30: Unknown tag: %fontpkg
error: query of specfile /chroot_mnt/cjkuni-uming-fonts/cjkuni-uming-fonts.spec failed, can't parse 
WARN[0010][rpmssnapshot] error: line 28: Unknown tag: %gometa
error: query of specfile /chroot_mnt/delve/delve.spec failed, can't parse 
WARN[0010][rpmssnapshot] error: line 38: Unknown tag: %fontpkg -a
error: query of specfile /chroot_mnt/overpass-fonts/overpass-fonts.spec failed, can't parse 
WARN[0010][rpmssnapshot] error: Unable to determine the distribution/version. This is generally caused by missing /etc/rpm/macros.dist. Please install the correct build packages or define the required macros manually.
error: query of specfile /chroot_mnt/resource-agents/resource-agents.spec failed, can't parse 
WARN[0010][rpmssnapshot] error: line 33: Unknown tag: %fontpkg
error: query of specfile /chroot_mnt/google-crosextra-caladea-fonts/google-crosextra-caladea-fonts.spec failed, can't parse 
cp /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json
```

Going to restore the directories of the package mentioned in above errors by their Mariner source code unmodified versions that were saved earlier as a back up.
These packages are - freeradius, lensfun, google-noto-emoji-fonts, ipa-pgothic-fonts, delve, overpass-fonts and google-crosextra-caladea-fonts.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ rm -rf freeradius/ lensfun/ google-noto-emoji-fonts/ ipa-pgothic-fonts/ delve/ overpass-fonts/ google-crosextra-caladea-fonts/ 
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ cp -r ../SavedMarinerPkg_ORIGINALS/freeradius/ .
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ cp -r ../SavedMarinerPkg_ORIGINALS/lensfun/ .
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ cp -r ../SavedMarinerPkg_ORIGINALS/google-noto-emoji-fonts/ .
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ cp -r ../SavedMarinerPkg_ORIGINALS/ipa-pgothic-fonts/ .
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ cp -r ../SavedMarinerPkg_ORIGINALS/delve/ .
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ cp -r ../SavedMarinerPkg_ORIGINALS/overpass-fonts/ .
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ cp -r ../SavedMarinerPkg_ORIGINALS/google-crosextra-caladea-fonts/ .
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ 
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ rm -rf cjkuni-uming-fonts/
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ cp -r ../SavedMarinerPkg
_ORIGINALS/cjkuni-uming-fonts/ .
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ 
```

Then there was an error reported by rpmssnapshot w.r.t. the resource-agents package too:

```
INFO[0007][srpmpacker] Packed (CharLS.spec) -> (CharLS-2.4.2-6.azl3.src.rpm) 
Finished updating /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/INTERMEDIATE_SRPMS
WARN[0012][rpmssnapshot] error: Unable to determine the distribution/version. This is generally caused by missing /etc/rpm/macros.dist. Please install the correct build packages or define the required macros manually.
error: query of specfile /chroot_mnt/resource-agents/resource-agents.spec failed, can't parse 
ERRO[0012][rpmssnapshot] Failed to generate snapshot from specs folder (../SPECS-EXTENDED/) into (/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/_rpms_snapshot.json). Error: failed to retrieve a list of specs inside (/chroot_mnt):
failed while querrying spec (/chroot_mnt/resource-agents/resource-agents.spec). Error: failed to query SPEC (/chroot_mnt/resource-agents/resource-agents.spec):
exit status 1. 
```

Carried out this change, i.e. restored resource-agents to the version already present in Mariner 3.0-dev:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls -ld resource*/
drwxrwxr-x. 2 neerajs neerajs 4096 Nov 17 09:10 resource-agents/
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls ../SavedMarinerPkg_ORIGINALS/resource-agents
resource-agents.signatures.json  resource-agents.spec
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ rm -rf resource-agents/
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls -ld resource*/
ls: cannot access 'resource*/': No such file or directory
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ cp -r ../SavedMarinerPkg_ORIGINALS/resource-agents/ .
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls -ld resource*/
drwxrwxr-x. 2 neerajs neerajs 4096 Nov 17 13:10 resource-agents/
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ 
```

After this the build was successful:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ ls -lrt bld_*.log | tail -5
-rw-rw-r--. 1 neerajs neerajs    864 Nov 17 10:43 bld_ALL_1_20241117-104255.log
-rw-rw-r--. 1 neerajs neerajs    864 Nov 17 11:03 bld_ALL_2_20241117-1103.log
-rw-rw-r--. 1 neerajs neerajs    864 Nov 17 11:04 bld_ALL_2_20241117-1104.log
-rw-rw-r--. 1 neerajs neerajs    864 Nov 17 11:28 bld_ALL_3_20241117-1127.log
-rw-rw-r--. 1 neerajs neerajs 513737 Nov 17 16:46 bld_CharLS_7_20241117-1312.log
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ date; tree -pugD out/
Sun Nov 17 17:02:36 UTC 2024
out/
â”œâ”€â”€ [drwxr-xr-x root     root     Nov 17 16:46]  RPMS
â”‚   â”œâ”€â”€ [drwxr-xr-x root     root     Jan  1  1970]  noarch
â”‚   â””â”€â”€ [drwxr-xr-x root     root     Nov 17 16:46]  x86_64
â”‚       â”œâ”€â”€ [-rw-r--r-- root     root     Nov 17 16:46]  CharLS-2.4.2-6.azl3.x86_64.rpm
â”‚       â”œâ”€â”€ [-rw-r--r-- root     root     Nov 17 16:46]  CharLS-debuginfo-2.4.2-6.azl3.x86_64.rpm
â”‚       â””â”€â”€ [-rw-r--r-- root     root     Nov 17 16:46]  CharLS-devel-2.4.2-6.azl3.x86_64.rpm
â”œâ”€â”€ [drwxr-xr-x root     root     Nov 17 16:46]  SRPMS
â”‚   â””â”€â”€ [-rw-r--r-- root     root     Nov 17 16:46]  CharLS-2.4.2-6.azl3.src.rpm
â”œâ”€â”€ [drwxr-xr-x root     root     Jan  1  1970]  images
â””â”€â”€ [-rw-r--r-- root     root     Nov 17 13:19]  rpms_snapshot.json

5 directories, 5 files
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ 
```


18 Nov 2024
===========

Today we did a build, as follows:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./first100pkgs.sh 
> ../bld_first100_2_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 25555
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    71m31.143s
user    0m0.010s
sys     0m0.009s
```

where the relevant portion of "first100pkgs.sh" is:

```
#./pkgbld.sh -s ../SPECS-EXTENDED -p "CharLS"
echo
echo
echo "Building 1 to 100 packages================================"
./pkgbld.sh -s ../SPECS-EXTENDED -p "389-ds-base  CharLS  GConf2  GeoIP  GeoIP-GeoLite-data  Judy  LibRaw  ORBit2  OpenEXR  PEGTL  PyGreSQL  SDL  SDL2  SDL_sound  SuperLU  Xaw3d  a52dec  accountsservice  acpid  adcli  adobe-mappings-cmap  adobe-mappings-pdf  advancecomp  alsa-firmware  alsa-plugins  amtk  amtterm  ansible-freeipa  aopalliance  apache-commons-beanutils  apache-commons-codec  apache-commons-collections  apache-commons-collections4  apache-commons-compress  apache-commons-daemon  apache-commons-dbcp  apache-commons-digester  apache-commons-httpclient  apache-commons-io  apache-commons-jexl  apache-commons-lang  apache-commons-net  apache-commons-pool  apache-commons-pool2  apache-commons-validator  apache-commons-vfs2  apache-parent  argparse-manpage  args4j  arptables  arpwatch  asio  aspell-en  audiofile  babeltrace  babl  baekmuk-ttf-fonts  base64coder  bats  bcache-tools  bcel  bea-stax  beust-jcommander  biosdevname  blosc  bogofilter  bolt  boom-boot  booth  botan2  breezy  bsf  buildah  bwidget  cachefilesd  cairomm  capnproto  capstone  cassandra  catatonit  catch1  cdparanoia  cdrdao  celt051  certmonger  cfitsio  cgdcbxd  cglib  chan  cim-schema  cjkuni-uming-fonts  cjose  cldr-emoji-annotation  clucene  clutter  clutter-gst3  clutter-gtk  cmake-fedora  cogl  colorize"
#echo
#echo
#echo "Building 101 to 200 packages================================"
```

This build failed and the logs are in the file "bld_first100_2_20241118-0824.log".

The understanding gained from these logs:


1. There are 17 packages which are being skipped by "srpmpacker".

```
[33mWARN[0m[0000][srpmpacker] Will update signature files as needed        
[36mINFO[0m[0007][rpmssnapshot] Generating RPMs snapshot from specs inside (../SPECS-EXTENDED). 
[36mINFO[0m[0007][specreader] Parsing SPECs inside a chroot environment    
[36mINFO[0m[0007][srpmpacker] Packing SRPMs inside a chroot environment    
[36mINFO[0m[0007][srpmpacker] Finding all SPEC files                       
[36mINFO[0m[0009][srpmpacker] Calculating SPECs to repack                  
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/apache-commons-codec/apache-commons-codec.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/aopalliance/aopalliance.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/args4j/args4j.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/cglib/cglib.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/apache-commons-collections4/apache-commons-collections4.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/apache-commons-io/apache-commons-io.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/beust-jcommander/beust-jcommander.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/apache-commons-beanutils/apache-commons-beanutils.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/apache-commons-compress/apache-commons-compress.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/bcel/bcel.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/apache-commons-net/apache-commons-net.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/apache-parent/apache-parent.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/apache-commons-pool/apache-commons-pool.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0010][srpmpacker] Skipping (/specs/apache-commons-digester/apache-commons-digester.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0011][srpmpacker] Skipping (/specs/apache-commons-jexl/apache-commons-jexl.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0011][srpmpacker] Skipping (/specs/apache-commons-collections/apache-commons-collections.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0011][srpmpacker] Skipping (/specs/bsf/bsf.spec) since it cannot be built on current architecture. 
[36mINFO[0m[0012][srpmpacker] Packing 83/100 SPECs                         
[33mWARN[0m[0012][specreader] Found a boolean condition 'libdecor-0.so.064bit if libwayland-client', make sure the packages on the left is available. Please refer to 'docs/how_it_works/3_package_building.md#rich-dependencies' for explanation of limitations. 
```

2. Rest 83 are being packed.
3. Out of those 83 "baekmuf-ttf-fonts" fails to be packed.  The reason is that four sources could not be downloaded successfully, even after 8 attempts for each.

```
[36mINFO[0m[0522][srpmpacker] Attempt 8/8: Failed to download (https://azurelinuxsrcstorage.blob.core.windows.net/sources/core/68-%{fontpkgname3}.conf) with error: (download error:
request failed:
parse "https://azurelinuxsrcstorage.blob.core.windows.net/sources/core/68-%{fontpkgname3}.conf": invalid URL escape "%{f") 
[31mERRO[0m[0522][srpmpacker] Failed to download (https://azurelinuxsrcstorage.blob.core.windows.net/sources/core/68-%{fontpkgname3}.conf). Error: failed to download (https://azurelinuxsrcstorage.blob.core.windows.net/sources/core/68-%{fontpkgname3}.conf) to (/build/baekmuk-ttf-fonts-2.2-63.azl3.src.rpm/SOURCES/68-%{fontpkgname3}.conf):
download error:
request failed:
parse "https://azurelinuxsrcstorage.blob.core.windows.net/sources/core/68-%{fontpkgname3}.conf": invalid URL escape "%{f". 
[31mERRO[0m[0522][srpmpacker] Unable to hydrate file: 68-%{fontpkgname2}.conf 
[31mERRO[0m[0522][srpmpacker] Unable to hydrate file: 68-%{fontpkgname1}.conf 
[31mERRO[0m[0522][srpmpacker] Unable to hydrate file: 68-%{fontpkgname4}.conf 
[31mERRO[0m[0522][srpmpacker] Unable to hydrate file: 68-%{fontpkgname3}.conf 
[31mERRO[0m[0522][srpmpacker] Failed to pack (/specs/baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec). Cancelling outstanding workers. Error: unable to hydrate files: [68-%{fontpkgname2}.conf 68-%{fontpkgname1}.conf 68-%{fontpkgname4}.conf 68-%{fontpkgname3}.conf] 
[31mPANI[0m[0523][srpmpacker] unable to hydrate files: [68-%{fontpkgname2}.conf 68-%{fontpkgname1}.conf 68-%{fontpkgname4}.conf 68-%{fontpkgname3}.conf] 
panic: (*logrus.Entry) 0xc000a14070
```
4. Proof that these four are the sources:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ grep -rn -e "fontpkgname" ./
./fonts-rpm-macros/fonts-rpm-macros-omit-foundry-in-family.patch:12:   fedora.safeset("fontpkgname"   .. suffix, rpmname(basename), verbose)
./fonts-rpm-macros/fonts-rpm-macros-omit-foundry-in-family.patch:14:   fedora.safeset("fontdir"       .. suffix, "%{_fontbasedir}/%{fontpkgname"  .. suffix .. "}", verbose)
./fonts-rpm-macros/fonts-rpm-macros-epoch-in-req.patch:20:   local fontpkgs = fedora.getsuffixed("fontpkgname")
./baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec:98:Source11: 68-%{fontpkgname1}.conf
./baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec:99:Source12: 68-%{fontpkgname2}.conf
./baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec:100:Source13: 68-%{fontpkgname3}.conf
./baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec:101:Source14: 68-%{fontpkgname4}.conf
```

5. As a result of failure to pack baekmuk-ttf-fonts, the build aborts:
```
[31mERRO[0m[0522][srpmpacker] Failed to pack (/specs/baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec). Cancelling outstanding workers. Error: unable to hydrate files: [68-%{fontpkgname2}.conf 68-%{fontpkgname1}.conf 68-%{fontpkgname4}.conf 68-%{fontpkgname3}.conf] 
[31mPANI[0m[0523][srpmpacker] unable to hydrate files: [68-%{fontpkgname2}.conf 68-%{fontpkgname1}.conf 68-%{fontpkgname4}.conf 68-%{fontpkgname3}.conf] 
panic: (*logrus.Entry) 0xc000a14070

goroutine 1 [running]:
```

PLAN POINTS PLAN POINTS PLAN POINTS PLAN POINTS

THE PLAN in light of these errors is:
PP 18 Nov: 1. Either remove "baekmuk-ttf-fonts" from the list of packages to be compiled.
PP 18 Nov: 2. Or look for a build option where the build proceeds ignoring failures in fetching source for some packages.

Then we see that there are many packages reported as "could not resolve".
There are 99 such packages.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ grep -e "could not resolve" bld_first100_2_20241118-0824.log | grep -e "^(" | sed -e "s/^(could not resolve //" | sed -e "s/)//" |sed -e "s/pkgconfig(//" | sed -e "s/)//"
gstreamer-base-1.0 
go-rpm-macros 
cogl-1.0 
jta_api 
physfs-devel 
python2-pytest 
python2 
libpipewire-0.3 
fedora-packager 
apache-commons-io 
geronimo-jta-1_1-api 
gstreamer-video-1.0 
python2-setuptools 
zopfli-devel 
bodhi-client 
pacemaker-libs-devel 
speexdsp 
python2-toml 
python2-packaging 
gstreamer-pbutils-1.0 
tk 
libdb-devel-static 
perl(SOAP::Lite 
resource-agents 
ansible-core 
doxygen-latex 
libdeflate 
containers-common-extra 
libsigc++20-devel 
sigc++-2.0 
speex-devel 
flac-devel 
commons-codec 
gstreamer-1.0 
ilmbase-devel(x86-64 
libpulse-simple 
python2-pip 
geoipupdate 
ffmpeg-free-devel 
jack 
libIDL-devel 
alsa-tools-firmware 
libao-devel 
libmodplug-devel 
cglib 
gstreamer-audio-1.0 
clutter-1.0 
jack-audio-connection-kit-devel 
cogl-2.0-experimental 
gsl-devel 
xerces-j2 
metis-devel 
koji 
speex 
gtkmm3.0-devel 
/usr/bin/pkill 
python3-dbusmock 
python3-argcomplete 
apache-commons-codec 
gi-docgen 
libdeflate 
httpcomponents-core 
apache-commons-collections4 
ibus-1.0 
parallel 
libogg-devel 
ilmbase-devel 
mikmod-devel 
fedpkg 
xdg-utils 
indent 
libtevent-devel 
commons-collections 
python2-devel 
gstreamer-tag-1.0 
speexdsp-devel 
lame-devel 
rust-packaging 
commons-digester 
libmad-devel 
python3-matplotlib 
python3-argparse-manpage
pulseaudio-libs-devel 
atlas-devel 
gstreamer-plugins-base-1.0 
podman 
libvorbis-devel 
apache-commons-compress 
pacemaker 
apache-commons-net 
libsamplerate-devel 
commons-beanutils 
libqb 
asciidoctor 
libdecor-0.so.064bit 
python3-ldap 
msopenjdk-11 
postgresql-test-rpm-macros 
libavtp-devel 
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ grep -e "could not resolve" bld_first100_2_20241118-0824.log | grep -e "^(" | sed -e "s/^(could not resolve //" | sed -e "s/)//" |sed -e "s/pkgconfig(//" | sed -e "s/)//" | wc
     99      99    1584
``` 

Lets find out which packages are dependent upon these packages.  The dependent ones can then be removed from the list provided for build.

```neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ unresplst=`grep -e "could not resolve" /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/bld_first100_2_202
41118-0824.log | grep -e "^(" | sed -e "s/^(could not resolve //" | sed -e "s/)//" |sed -e "s/pkgconfig(//" | sed -e "s/)//"`
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ echo $unresplst | wc
      1      99    1485
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ li=`for i in \`echo $unresplst\`; do  echo -n "$i "; done`
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ echo $li
gstreamer-base-1.0 go-rpm-macros cogl-1.0 jta_api physfs-devel python2-pytest python2 libpipewire-0.3 fedora-packager apache-commons-io geronimo-jta-1_1-api gstreamer-video-1.0 python2-setuptools zopfli-devel bodhi-client pacemaker-libs-devel speexdsp python2-toml python2-packaging gstreamer-pbutils-1.0 tk libdb-devel-static perl(SOAP::Lite resource-agents ansible-core doxygen-latex libdeflate containers-common-extra libsigc++20-devel sigc++-2.0 speex-devel flac-devel commons-codec gstreamer-1.0 ilmbase-devel(x86-64 libpulse-simple python2-pip geoipupdate ffmpeg-free-devel jack libIDL-devel alsa-tools-firmware libao-devel libmodplug-devel cglib gstreamer-audio-1.0 clutter-1.0 jack-audio-connection-kit-devel cogl-2.0-experimental gsl-devel xerces-j2 metis-devel koji speex gtkmm3.0-devel /usr/bin/pkill python3-dbusmock python3-argcomplete apache-commons-codec gi-docgen libdeflate httpcomponents-core apache-commons-collections4 ibus-1.0 parallel libogg-devel ilmbase-devel mikmod-devel fedpkg xdg-utils indent libtevent-devel commons-collections python2-devel gstreamer-tag-1.0 speexdsp-devel lame-devel rust-packaging commons-digester libmad-devel python3-matplotlib python3-argparse-manpage pulseaudio-libs-devel atlas-devel gstreamer-plugins-base-1.0 podman libvorbis-devel apache-commons-compress pacemaker apache-commons-net libsamplerate-devel commons-beanutils libqb asciidoctor libdecor-0.so.064bit python3-ldap msopenjdk-11 postgresql-test-rpm-macros libavtp-devel
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ go run depsearch.go --input=../../../build/pkg_artifacts/graph.dot --packages="$li"
WARN[0000][depsearch] Default toolchain filter file (./resources/manifests/package/toolchain_x86_64.txt) not found, setting to '' 
INFO[0000][depsearch] Filter file () not applicable here           
INFO[0000][depsearch] Reading DOT graph from ../../../build/pkg_artifacts/graph.dot 
INFO[0000][depsearch] Found 80 nodes to consider                   
INFO[0000][depsearch] Forward search will list all dependants which rely on any of the provided packages 
INFO[0000][depsearch] Scanned 0 nodes                              
389-ds-base
GConf2
GeoIP
ORBit2
OpenEXR
PyGreSQL
SDL
SDL2
SDL_sound
SuperLU
accountsservice
advancecomp
alsa-firmware
alsa-plugins
amtterm
ansible-freeipa
apache-commons-dbcp
apache-commons-httpclient
apache-commons-pool2
apache-commons-validator
apache-commons-vfs2
argparse-manpage
audiofile
babl
bats
blosc
bogofilter
booth
breezy
buildah
bwidget
cairomm
capstone
cassandra
cdrdao
celt051
certmonger
cmake-fedora
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ go run depsearch.go --input=../../../build/pkg_artifacts/graph.dot --packages="$li" | wc
WARN[0000][depsearch] Default toolchain filter file (./resources/manifests/package/toolchain_x86_64.txt) not found, setting to '' 
INFO[0000][depsearch] Filter file () not applicable here           
INFO[0000][depsearch] Reading DOT graph from ../../../build/pkg_artifacts/graph.dot 
INFO[0000][depsearch] Found 80 nodes to consider                   
INFO[0000][depsearch] Forward search will list all dependants which rely on any of the provided packages 
INFO[0000][depsearch] Scanned 0 nodes                              
     38      38     416
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ 
```

In the meeting on 19 Nov it was reasoned that many of these packages (perhaps all) are there in SPECS-EXTENDED.  Therefore, if we build all the packages together, many of these 38 packages should be available in "out" and therefore their not getting resolved in the above stage should not finally prevent the builds dependent on them. 

Another thing was noticed that since daily build of SPECS-EXTENDED is successful in pipeline, the problem of "multiple target patterns" seen when ALL the packages are attempted for build, might be due to the packages that were newly added to SPECS-EXTENDED under this exercise.

PLAN PLAN PLAN PLAN

Therefore, the plan is to remove the packages that were newly added to SPECS-EXTENDED and then try a build of all the packages in SPECS-EXTENDED.

These new packages were identified by comparing our topic branch with newly cloned 3.0-dev.
These turned out to be 9 packages.
These were removed.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls | wc
   1513    1513   20177
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ srchdir=/sec_disk/Microsoft_AZL_REPO/azurelinux/SPECS-EXTENDED/; for drctry in `ls` ; do if ! [ -d $srchdir/$drct
ry ] ; then echo $drctry " not in $srchdir" ; fi ; done
argparse-manpage  not in /sec_disk/Microsoft_AZL_REPO/azurelinux/SPECS-EXTENDED/
bogofilter  not in /sec_disk/Microsoft_AZL_REPO/azurelinux/SPECS-EXTENDED/
fapolicyd  not in /sec_disk/Microsoft_AZL_REPO/azurelinux/SPECS-EXTENDED/
libdbi-drivers  not in /sec_disk/Microsoft_AZL_REPO/azurelinux/SPECS-EXTENDED/
perl-BDB  not in /sec_disk/Microsoft_AZL_REPO/azurelinux/SPECS-EXTENDED/
python-redis  not in /sec_disk/Microsoft_AZL_REPO/azurelinux/SPECS-EXTENDED/
redland  not in /sec_disk/Microsoft_AZL_REPO/azurelinux/SPECS-EXTENDED/
sendmail  not in /sec_disk/Microsoft_AZL_REPO/azurelinux/SPECS-EXTENDED/
tpm-tools  not in /sec_disk/Microsoft_AZL_REPO/azurelinux/SPECS-EXTENDED/
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls -d argparse-manpage/ bogofilter/ fapolicyd/ libdbi-drivers/ perl-BDB/ python-redis/ redland/ sendmail/ tpm-tools
argparse-manpage/  fapolicyd/       perl-BDB/      redland/   tpm-tools
bogofilter/        libdbi-drivers/  python-redis/  sendmail/
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ rm -rf argpa
rse-manpage/ bogofilter/ fapolicyd/ libdbi-drivers/ perl-BDB/ python-redis/ redland/ sendmail/ tpm-to
ols
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls -d argparse-manpage/ bogofilter/ fapolicyd/ libdbi-drivers/ perl-BDB/ python-redis/ redland/ sendmail/ tpm-tools
ls: cannot access 'argparse-manpage/': No such file or directory
ls: cannot access 'bogofilter/': No such file or directory
ls: cannot access 'fapolicyd/': No such file or directory
ls: cannot access 'libdbi-drivers/': No such file or directory
ls: cannot access 'perl-BDB/': No such file or directory
ls: cannot access 'python-redis/': No such file or directory
ls: cannot access 'redland/': No such file or directory
ls: cannot access 'sendmail/': No such file or directory
ls: cannot access 'tpm-tools': No such file or directory
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls | wc
   1504    1504   20075
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ srchdir=/sec_disk/Microsoft_AZL_REPO/azurelinux/SPECS-EXTENDED/; for drctry in `ls` ; do if ! [ -d $srchdir/$drctry ] ; then echo $drctry " not in $srchdir" ; fi ; done |wc
      0       0       0
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ 
```

The same error of "multiple target patterns" was seen.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./modified_pkg
bld.sh -s ../SPECS-EXTENDED/ -p ALL > bld_ALL_5_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 2263
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    0m4.494s
user    0m0.011s
sys     0m0.000s

[1]+  Exit 2                  time ./modified_pkgbld.sh -s ../SPECS-EXTENDED/ -p ALL > bld_ALL_5_$(date +%Y%m%d-%H%M).log 2>&1
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ cat bld_ALL_5_20241
119-1850.log 
/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/daily_build.mk:46: Using Daily Build 3-0-20241119
Running update_manifest.sh as neerajs
Checking for updates to toolchain_x86_64.txt manifest from https://raw.githubusercontent.com/microsoft/CBL-Mariner/ec144b0a684314c1e8f265a2d14555984d864229/toolkit/resources/manifests/package/toolchain_x86_64.txt
Manifests are the same, not updating toolchain_x86_64.txt
Running update_manifest.sh as neerajs
Checking for updates to pkggen_core_x86_64.txt manifest from https://raw.githubusercontent.com/microsoft/CBL-Mariner/ec144b0a684314c1e8f265a2d14555984d864229/toolkit/resources/manifests/package/pkggen_core_x86_64.txt
Manifests are the same, not updating pkggen_core_x86_64.txt
/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/srpm_pack.mk:80: *** multiple target patterns.  Stop.
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
```

Even after removing the above, a BUILD for ALL failed with the same error.
Thereofore, decided to reduce the packages in parts.

Using binsrch_multitrgt.sh started with all the 1505 packages listed in -p option to "bldpkg.sh".

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ sudo ./binsrch_multitrgt.sh > ../bld_binsrch_1_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 2762
```

Next time reduced the number of packages to the first 900 and then built.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ sudo ./binsrch_multitrgt.sh > ../bld_binsrch_2_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 2967
```

That too failed with the "multiple target patterns" error.

Therefore, reduced to the packages to the first 800 and then triggered the build.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ sudo ./binsrch_multitrgt.sh > ../bld_binsrch_3_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 3172
```

This time it started running.

20 Nov 2024
===========

In the meeting today, got the input that the "multiple target patterns" error might be due to the presence of special characters.

Looked for special characters in file names inside SPECS-EXTENDED.  No filenames had special characters.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls | grep -e "\^"
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ ls | grep -e "~"
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ 
```

Then looked for special characters, "^" and "~" in the "Version:" tags inside the spec files.  Nine such packages were found:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ spcl_char_specs=`grep -rn -I -e "^Version:" | grep -e "[\^~]" | awk 'BEGIN { FS=":"} {print $1}'`
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ echo $spcl_char_specs 
libtommath/libtommath.spec usbmuxd/usbmuxd.spec libmpcdec/libmpcdec.spec perl-Crypt-PasswdMD5/perl-Crypt-PasswdMD5.spec libetonyek/libetonyek.spec libusbmuxd/libusbmuxd.spec perl-XML-LibXSLT/perl-XML-LibXSLT.spec python-curio/python-curio.spec libimobiledevice/libimobiledevice.spec
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ echo $spcl_char_specs  | wc
      1       9     283
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ for i in `echo $spcl_char_specs`; do  grep "^Version:" $i; done
Version:        1.3.1~rc1
Version:        1.1.1^%{date}git%{shortcommit}
Version: 1.3.0^20110810svn%{svn_release}
Version:        %(echo '%{cpan_version}' | sed 's/\.\(.\)/.\1./')
Version: 0.1.11~20230802.git9c3a8cb
Version:        2.0.2^%{date}git%{shortcommit}
Version:    %(echo '%{cpan_version}' | sed 's/\(\....\)\(.\)/\1.\2/')
Version:        1.6^1.%{shortcommit}
Version:        1.3.0^%{date}git%{shortcommit}
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ 
```

The plan is to try changing the version numbering in these files after removing the special characters.  Perhaps we will only retain the part of version string
that precedes a first such special character.


Accordingly, changed these files.  Out of the 9 above changed only 7, because the two files - perl-Crypt-PasswdMD5/perl-Crypt-PasswdMD5.spec and perl-XML-LibXSLT/perl-XML-LibXSLT.spec, 
did not have a ~ or a ^, and I am not sure why these two turn up in the search for ~ or ^.  
Moreover, these two files have the same version strings even in Mariner 3.0-dev.  Therefore, these must not be contributing to the "multiple target patterns" error.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ echo $dirtosrch 
/home/neerajs/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson/output/fedora/specs/
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ for i in `echo $spcl_char_specs`; do  echo $i; diff $dirtosrch/$i ./$i; done
libtommath/libtommath.spec
12c12
< Version:        1.3.1~rc1
---
> Version:        1.3.1
usbmuxd/usbmuxd.spec
17c17
< Version:        1.1.1^%{date}git%{shortcommit}
---
> Version:        1.1.1
libmpcdec/libmpcdec.spec
23c23
< Version: 1.3.0^20110810svn%{svn_release}
---
> Version: 1.3.0
perl-Crypt-PasswdMD5/perl-Crypt-PasswdMD5.spec
libetonyek/libetonyek.spec
14c14
< Version: 0.1.11~20230802.git9c3a8cb
---
> Version: 0.1.11
libusbmuxd/libusbmuxd.spec
17c17
< Version:        2.0.2^%{date}git%{shortcommit}
---
> Version:        2.0.2
perl-XML-LibXSLT/perl-XML-LibXSLT.spec
python-curio/python-curio.spec
18c18
< Version:        1.6^1.%{shortcommit}
---
> Version:        1.6
libimobiledevice/libimobiledevice.spec
17c17
< Version:        1.3.0^%{date}git%{shortcommit}
---
> Version:        1.3.0
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ 
```


We got the "multiple target patterns" error even after that.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./modified_pkg
bld.sh -s ../SPECS-EXTENDED/ -p "ALL" > ../bld_ALL_5_$(date +%Y%d%m-%H%M).log 2>&1 &
[1] 15133
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    0m4.509s
user    0m0.010s
sys     0m0.003s
[1]+  Exit 2                  time ./modified_pkgbld.sh -s ../SPECS-EXTENDED/ -p "ALL" > ../bld_ALL_5_$(date +%Y%d%m-%H%M).log 2>&1
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ tail -f ../bld_ALL_5_20242011-1309.log 
/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/daily_build.mk:46: Using Daily Build 3-0-20241119
Running update_manifest.sh as neerajs
Checking for updates to toolchain_x86_64.txt manifest from https://raw.githubusercontent.com/microsoft/CBL-Mariner/ec144b0a684314c1e8f265a2d14555984d864229/toolkit/resources/manifests/package/toolchain_x86_64.txt
Manifests are the same, not updating toolchain_x86_64.txt
Running update_manifest.sh as neerajs
Checking for updates to pkggen_core_x86_64.txt manifest from https://raw.githubusercontent.com/microsoft/CBL-Mariner/ec144b0a684314c1e8f265a2d14555984d864229/toolkit/resources/manifests/package/pkggen_core_x86_64.txt
Manifests are the same, not updating pkggen_core_x86_64.txt
/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/srpm_pack.mk:80: *** multiple target patterns.  Stop.
```



Tried some more changes.  Basically tried to change the name of tar.gz in case it appeared to me that it won't expand properly.  One important change was to replace "version_no_tilde" macro by
hardcoded numbers that matched the name of the tar.* file in the specs directory.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ echo $dirtosrch
/home/neerajs/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson/output/fedora/specs/
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ for i in `echo $spcl_char_specs`; do  echo $i; diff $dirtosrch/$i ./$i; done
libtommath/libtommath.spec
12,13c12,13
< Version:        1.3.1~rc1
< Release:        %autorelease
---
> Version:        1.3.1
> Release:        rc1
18,19c18
< Source0:        https://github.com/libtom/%{name}/archive/v%{version_no_tilde}.tar.gz#/%{name}-%{version_no_tilde}.tar.gz
< 
---
> Source0:        https://github.com/libtom/%{name}/archive/v61b99ab5c25609c11369733a0df97c03a0581a56.tar.gz#/%{name}-61b99ab5c25609c11369733a0df97c03a0581a56.tar.gz
69c68
< %autosetup -p1 -n %{name}-%{version_no_tilde}
---
> %autosetup -p1 -n %{name}-61b99ab5c25609c11369733a0df97c03a0581a56
usbmuxd/usbmuxd.spec
17c17,18
< Version:        1.1.1^%{date}git%{shortcommit}
---
> Version:        1.1.1
> 
libmpcdec/libmpcdec.spec
23c23
< Version: 1.3.0^20110810svn%{svn_release}
---
> Version: 1.3.0
perl-Crypt-PasswdMD5/perl-Crypt-PasswdMD5.spec
libetonyek/libetonyek.spec
14c14
< Version: 0.1.11~20230802.git9c3a8cb
---
> Version: 0.1.11
libusbmuxd/libusbmuxd.spec
17c17
< Version:        2.0.2^%{date}git%{shortcommit}
---
> Version:        2.0.2
perl-XML-LibXSLT/perl-XML-LibXSLT.spec
python-curio/python-curio.spec
18c18
< Version:        1.6^1.%{shortcommit}
---
> Version:        1.6
libimobiledevice/libimobiledevice.spec
17c17
< Version:        1.3.0^%{date}git%{shortcommit}
---
> Version:        1.3.0
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ 
```


But even after this the build threw the same error:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./modified_pkg
bld.sh -s ../SPECS-EXTENDED/ -p "ALL" > ../bld_ALL_7_$(date +%Y%d%m-%H%M).log 2>&1 &
[1] 27303
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    0m4.428s
user    0m0.005s
sys     0m0.005s

[1]+  Exit 2                  time ./modified_pkgbld.sh -s ../SPECS-EXTENDED/ -p "ALL" > ../bld_ALL_7_$(date +%Y%d%m-%H%M).log 2>&1
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ tail -f ../bld_ALL_7_20242011-1429.log 
/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/daily_build.mk:46: Using Daily Build 3-0-20241119
Running update_manifest.sh as neerajs
Checking for updates to toolchain_x86_64.txt manifest from https://raw.githubusercontent.com/microsoft/CBL-Mariner/ec144b0a684314c1e8f265a2d14555984d864229/toolkit/resources/manifests/package/toolchain_x86_64.txt
Manifests are the same, not updating toolchain_x86_64.txt
Running update_manifest.sh as neerajs
Checking for updates to pkggen_core_x86_64.txt manifest from https://raw.githubusercontent.com/microsoft/CBL-Mariner/ec144b0a684314c1e8f265a2d14555984d864229/toolkit/resources/manifests/package/pkggen_core_x86_64.txt
Manifests are the same, not updating pkggen_core_x86_64.txt
/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/srpm_pack.mk:80: *** multiple target patterns.  Stop.
```

Can we try removing these 7  packages from the build?
The packages for which we have modified the spec file.  Note that out of the 9 packages discussed above only for 7 we changed the spec file.


Lets pick the binsrch_multitrgt.sh shell script, remove these 7 packages from it and try the build.

Even this time the same error happened:

```neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_mult
itrgt.sh > bld_binsrch_minus7_1_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 30821
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    0m16.020s
user    0m0.008s
sys     0m0.008s

[1]+  Exit 2                  time ./binsrch_multitrgt.sh > bld_binsrch_minus7_1_$(date +%Y%m%d-%H%M).log 2>&1
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ tail -f bld_binsrch_minus7_1_20241120-1452.log 
/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/daily_build.mk:46: Using Daily Build 3-0-20241119
Running update_manifest.sh as neerajs
Checking for updates to toolchain_x86_64.txt manifest from https://raw.githubusercontent.com/microsoft/CBL-Mariner/ec144b0a684314c1e8f265a2d14555984d864229/toolkit/resources/manifests/package/toolchain_x86_64.txt
Manifests are the same, not updating toolchain_x86_64.txt
Running update_manifest.sh as neerajs
Checking for updates to pkggen_core_x86_64.txt manifest from https://raw.githubusercontent.com/microsoft/CBL-Mariner/ec144b0a684314c1e8f265a2d14555984d864229/toolkit/resources/manifests/package/pkggen_core_x86_64.txt
Manifests are the same, not updating pkggen_core_x86_64.txt
/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/srpm_pack.mk:80: *** multiple target patterns.  Stop.
```


Trying by removing two more packages:
perl-Crypt-PasswdMD5/perl-Crypt-PasswdMD5.spec perl-XML-LibXSLT/perl-XML-LibXSLT.spec

This time it started and moved past the "multiple target patterns" error.

But then it failed at the end of precacher execution itself.  No build was attempted.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > bld_binsrch_minus9_1_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 31933
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    6m4.053s
user    0m0.005s
sys     0m0.012s
```

The last few lines of the build log are:

```WARN[0034][precacher] Could not find 'dyninst-debuginfo-12.3.0-7.azl3.x86_64.rpm' in any repos 
WARN[0034][precacher] Could not find 'libipt-debuginfo-2.1.1-2.azl3.x86_64.rpm' in any repos 
WARN[0034][precacher] Could not find 'polkit-pkla-compat-debuginfo-0.1-29.azl3.x86_64.rpm' in any repos 
INFO[0034][precacher] Pre-caching: 100% ( downloaded:    0, skipped:    0, unavailable: 3792, failed:    0 ) 
INFO[0034][precacher] Downloaded 0 packages into the cache         
INFO[0034][precacher] Writing summary file to '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/precache/downloaded_files.txt' 
```


This time trying the same after a "make clean".

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > bld_binsrch_minus9_2_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 40100
```

The failure was with error :
unexpected number of matches (0) for spec file (setup) in directory
unexpected number of matches (0) for spec file (binsrch_multitrgt.sh) in directory
```
touch /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/make_status/build_srpms.flag
WARN[0000][srpmpacker] Will update signature files as needed        
cp /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json
cp: cannot stat '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json': No such file or directory
make: *** [/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/toolkit.mk:94: /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json] Error 1
make: *** Waiting for unfinished jobs....
INFO[0005][srpmpacker] Packing SRPMs inside a chroot environment    
INFO[0005][srpmpacker] Finding all SPEC files                       
PANI[0034][specreader] failed to parse native specs:
failed to parse specs: 
unexpected number of matches (0) for spec file (setup) in directory (/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED)
unexpected number of matches (0) for spec file (binsrch_multitrgt.sh) in directory (/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED) 
panic: (*logrus.Entry) 0xc0000ce0e0

goroutine 1 [running]:
```

Removed these two i.e. setup and binsrch_multitrgt.sh strings from the list of packages that were being provided to the bldpkg.sh.
Trying again.  Again did a make clean before the build.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus9_3_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 98201
```



This time it failed for the want of 4 Source file for "baekmuk-ttf-fonts" package.  The error was encountered by "srpmpacker"

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus9_3_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 98201
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    29m14.496s
user    0m0.011s
sys     0m0.008s
```

The details are:

```
INFO[0594][srpmpacker] Attempt 8/8: Failed to download (https://azurelinuxsrcstorage.blob.core.windows.net/sources/core/68-%{fontpkgname1}.conf) with error: (download error:
request failed:
parse "https://azurelinuxsrcstorage.blob.core.windows.net/sources/core/68-%{fontpkgname1}.conf": invalid URL escape "%{f") 
ERRO[0594][srpmpacker] Failed to download (https://azurelinuxsrcstorage.blob.core.windows.net/sources/core/68-%{fontpkgname1}.conf). Error: failed to download (https://azurelinuxsrcstorage.blob.core.windows.net/sources/core/68-%{fontpkgname1}.conf) to (/build/baekmuk-ttf-fonts-2.2-63.azl3.src.rpm/SOURCES/68-%{fontpkgname1}.conf):
download error:
request failed:
parse "https://azurelinuxsrcstorage.blob.core.windows.net/sources/core/68-%{fontpkgname1}.conf": invalid URL escape "%{f". 
ERRO[0594][srpmpacker] Unable to hydrate file: 68-%{fontpkgname3}.conf 
ERRO[0594][srpmpacker] Unable to hydrate file: 68-%{fontpkgname2}.conf 
ERRO[0594][srpmpacker] Unable to hydrate file: 68-%{fontpkgname1}.conf 
ERRO[0594][srpmpacker] Unable to hydrate file: 68-%{fontpkgname4}.conf 
ERRO[0594][srpmpacker] Failed to pack (/specs/baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec). Cancelling outstanding workers. Error: unable to hydrate files: [68-%{fontpkgname3}.conf 68-%{fontpkgname2}.conf 68-%{fontpkgname1}.conf 68-%{fontpkgname4}.conf] 
PANI[1173][srpmpacker] unable to hydrate files: [68-%{fontpkgname3}.conf 68-%{fontpkgname2}.conf 68-%{fontpkgname1}.conf 68-%{fontpkgname4}.conf] 
panic: (*logrus.Entry) 0xc001218070
```


Lets build after removing baekmuk-ttf-fonts.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_mult
itrgt.sh > ../bld_binsrch_minus_baekmuk_1_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 1245
```

This time it failed 

```
WARN[0000][srpmpacker] Will update signature files as needed        
INFO[0006][rpmssnapshot] Generating RPMs snapshot from specs inside (../SPECS-EXTENDED). 
INFO[0006][specreader] Parsing SPECs inside a chroot environment    
INFO[0006][srpmpacker] Packing SRPMs inside a chroot environment    
INFO[0006][srpmpacker] Finding all SPEC files                       
INFO[0018][rpmssnapshot] Found 1457 compatible specs.                 
INFO[0024][rpmssnapshot] The specs build 3792 packages in total.      
ERRO[0024][rpmssnapshot] Failed to generate snapshot from specs folder (../SPECS-EXTENDED) into (/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json). Error: failed to convert RPMs list to a packages summary file:
RPM package name (libtommath-1.3.1-rc1.x86_64) doesn't match the regular expression (^(.*)-([^-]+-[^-]+)\.([^.]+)\.([^.]+)$) 
cp /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json
cp: cannot stat '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json': No such file or directory
make: *** [/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/toolkit.mk:94: /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json] Error 1
make: *** Waiting for unfinished jobs....
```

Is it because of the changes I did to the spec file of libtommath??

Changing libtommath.spec once again.  This time instead of the large commit id we will be using 1.3.1-rc1 in the names of tar.gz occurring in the spec file.
In the previous change to this file we had replaced %{version_no_tilde} by a commit id.
This time we use 1.3.1-rc1 in its place.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ diff ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson/output/fedora/specs/libtommath/libtommath.spec  ./SPECS-EXTENDED/libtommath/libtommath.spec 
12,13c12,13
< Version:        1.3.1~rc1
< Release:        %autorelease
---
> Version:        1.3.1
> Release:        rc1
18,19c18
< Source0:        https://github.com/libtom/%{name}/archive/v%{version_no_tilde}.tar.gz#/%{name}-%{version_no_tilde}.tar.gz
< 
---
> Source0:        https://github.com/libtom/%{name}/archive/v1.3.1-rc1.tar.gz#/%{name}-1.3.1-rc1.tar.gz
69c68
< %autosetup -p1 -n %{name}-%{version_no_tilde}
---
> %autosetup -p1 -n %{name}-1.3.1-rc1
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ 
```

The command given for the build was:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_baekmuk_2_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 106627
```

Again the same error was seen:

```
INFO[0005][rpmssnapshot] Generating RPMs snapshot from specs inside (../SPECS-EXTENDED). 
INFO[0005][specreader] Parsing SPECs inside a chroot environment    
INFO[0016][rpmssnapshot] Found 1457 compatible specs.                 
INFO[0022][rpmssnapshot] The specs build 3792 packages in total.      
ERRO[0022][rpmssnapshot] Failed to generate snapshot from specs folder (../SPECS-EXTENDED) into (/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json). Error: failed to convert RPMs list to a packages summary file:
RPM package name (libtommath-1.3.1-rc1.x86_64) doesn't match the regular expression (^(.*)-([^-]+-[^-]+)\.([^.]+)\.([^.]+)$) 
cp /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json
cp: cannot stat '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json': No such file or directory
make: *** [/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/toolkit.mk:94: /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json] Error 1
make: *** Waiting for unfinished jobs....
WARN[0036][specreader] Found a boolean condition 'ruby-default-gems < 3.3 or rubygemracc', make sure both packages are available. Please refer to 'd
```

There was another error too:

```
WARN[0057][specreader] Found a boolean condition 'libsecret = 0.21.4-3.azl3 if libsecret', make sure the packages on the left is available. Please refer to 'docs/how_it_works/3_package_building.md#rich-dependencies' for explanation of limitations. 
WARN[0057][specreader] Found a boolean condition 'ibus-gtk2x86-64 = 1.5.31-1.azl3 if gtk2', make sure the packages on the left is available. Please refer to 'docs/how_it_works/3_package_building.md#rich-dependencies' for explanation of limitations. 
PANI[0058][specreader] failed to parse native specs:
found more than one boolean condition inside '(ibus-xinit = 1.5.31-1.azl3 if (budgie-desktop or cinnamon or deepin-desktop or i3 or lxqt-session or lxsession or mate-panel or phosh or plasma-workspace or sugar or xfce4-session))'. Please refer to 'docs/how_it_works/3_package_building.md#rich-dependencies' for explanation of limitations 
panic: (*logrus.Entry) 0xc00028e070

goroutine 1 [running]:
github.com/sirupsen/logrus.(*Entry).log(0
```

For the time being removing libtommath.

21 Nov 2024
===========

Continuing from where we left on 20 Nov (see above).

Therefore, removed libtommath from the list os packages to be built.

This time again it failed within 2 minutes of build run:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_mult
itrgt.sh > ../bld_binsrch_minus_tommath_1_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 186258
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    1m40.981s
user    0m0.020s
sys     0m0.009s
```

Both the errors were still there.  
1. The failure of rpmssnapshot in converting RPMs list to a package summary file, with the reason being that the libtommath tar.gz file name not matching a regular expression.
2. specreader failing to parse because of multiple boolean conditions found for ibus-xinit.

```
INFO[0007][rpmssnapshot] Generating RPMs snapshot from specs inside (../SPECS-EXTENDED). 
INFO[0007][specreader] Parsing SPECs inside a chroot environment    
INFO[0024][rpmssnapshot] Found 1457 compatible specs.                 
INFO[0033][rpmssnapshot] The specs build 3792 packages in total.      
ERRO[0033][rpmssnapshot] Failed to generate snapshot from specs folder (../SPECS-EXTENDED) into (/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json). Error: failed to convert RPMs list to a packages summary file:
RPM package name (libtommath-1.3.1-rc1.x86_64) doesn't match the regular expression (^(.*)-([^-]+-[^-]+)\.([^.]+)\.([^.]+)$) 
cp /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json
cp: cannot stat '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json': No such file or directory
...
...
...
...
...
WARN[0056][specreader] Found a boolean condition 'rubygemthor >= 1.0.1 with rubygemthor < 1.3', make sure both packages are available. Please refer to 'docs/how_it_works/3_package_building.md#rich-dependencies' for explanation of limitations. 
PANI[0057][specreader] failed to parse native specs:
found more than one boolean condition inside '(ibus-xinit = 1.5.31-1.azl3 if (budgie-desktop or cinnamon or deepin-desktop or i3 or lxqt-session or lxsession or mate-panel or phosh or plasma-workspace or sugar or xfce4-session))'. Please refer to 'docs/how_it_works/3_package_building.md#rich-dependencies' for explanation of limitations 
panic: (*logrus.Entry) 0xc0003200e0
```

We had removed libtommath from the list of packages to be built.  Still we got an error mentioning libtommath.
Should I try make clean again?

Lets try a build after make clean.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ sudo make clean > /dev/null
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_2_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 231548
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    73m38.059s
user    0m0.009s
sys     0m0.020s
```

It failied after 73 minutes.

The last few lines of the log were:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ tail -f bld_binsrch_minus_tommath_2_20241121-0247.log 
INFO[0196][srpmpacker] Packed (xorg-x11-utils.spec) -> (xorg-x11-utils-7.5-35.azl3.src.rpm) 
INFO[0207][srpmpacker] Packed (cri-o.spec) -> (cri-o-1.30.1-1.azl3.src.rpm) 
INFO[0246][srpmpacker] Packed (cassandra.spec) -> (cassandra-4.0.10-1.azl3.src.rpm) 
INFO[0260][srpmpacker] Packed (kernel-rt.spec) -> (kernel-rt-6.6.44.1-1.azl3.src.rpm) 
INFO[0269][srpmpacker] Packed (stress-ng.spec) -> (stress-ng-0.18.02-2.azl3.src.rpm) 
INFO[0269][srpmpacker] Packed (pmdk-convert.spec) -> (pmdk-convert-1.7-3.azl3.src.rpm) 
INFO[0368][srpmpacker] Packed (ipa-pgothic-fonts.spec) -> (ipa-pgothic-fonts-003.03-17.azl3.src.rpm) 
INFO[0391][srpmpacker] Packed (cjkuni-uming-fonts.spec) -> (cjkuni-uming-fonts-0.2.20080216.1-65.azl3.src.rpm) 
INFO[1659][srpmpacker] Packed (389-ds-base.spec) -> (389-ds-base-3.1.1-2.azl3.src.rpm) 
INFO[1910][srpmpacker] Packed (google-noto-cjk-fonts.spec) -> (google-noto-cjk-fonts-20190416-7.azl3.src.rpm) 
```

We still see the same two issues.  
	1. Removal of libtommath from the list of packages to build did not remove the error that libtommath-1.3.1-rc1.x86_64 did not match a certain regular expression.
	2. The error related to boolean conditions and ibus-xinit was also present.

```
1155 ^[[36mINFO^[[0m[0026][rpmssnapshot] Found 1457 compatible specs.                 
1156 ^[[36mINFO^[[0m[0035][rpmssnapshot] The specs build 3792 packages in total.      
1157 ^[[31mERRO^[[0m[0035][rpmssnapshot] Failed to generate snapshot from specs folder (../SPECS-EXTENDED) into (/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json). Error: failed to convert RPMs list to a packages summary file:
1158 RPM package name (libtommath-1.3.1-rc1.x86_64) doesn't match the regular expression (^(.*)-([^-]+-[^-]+)\.([^.]+)\.([^.]+)$) 
1159 cp /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json1160 cp: cannot stat '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json': No such file or directory
1161 make: *** [/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/toolkit.mk:94: /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json] Error 1
1162 make: *** Waiting for unfinished jobs....
1163 ^[[36mINFO^[[0m[0050][srpmpacker] Calculating SPECs to repack      
...
...
...
...
1211 ^[[36mINFO^[[0m[0076][srpmpacker] Skipping (/specs/apache-commons-net/apache-commons-net.spec) since it cannot be built on current architecture.
1212 ^[[36mINFO^[[0m[0077][srpmpacker] Skipping (/specs/jsoup/jsoup.spec) since it cannot be built on current architecture.
1213 ^[[31mPANI^[[0m[0077][specreader] failed to parse native specs:
1214 found more than one boolean condition inside '(ibus-xinit = 1.5.31-1.azl3 if (budgie-desktop or cinnamon or deepin-desktop or i3 or lxqt-session or lxsession or mate-panel or phosh or plasma-w     orkspace or sugar or xfce4-session))'. Please refer to 'docs/how_it_works/3_package_building.md#rich-dependencies' for explanation of limitations
1215 panic: (*logrus.Entry) 0xc000178000
1216 1217 goroutine 1 [running]:
```


The ibus.spec lines below seem to be causing the ibus-xinit error.

```
 123 %if %{with xinit}
 124 Requires:      (%{name}-xinit          = %{version}-%{release} if %ibus_xinit_condition)
 125 %endif
 126 
```

Change Num 1 before next build try:

After checking the ibus.spec contents and the source code downloaded it from Fedora 41, I am inclined to try using the 
Mariner version of ibus spec file, changing only the "Version:" and "Release:" tags to reflect the latest Fedora 41 
Version and release.
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ cp SavedMarinerPkg_ORIGINALS/ibus/ibus.spec SPECS-EXTENDED/ibus/ibus.spec  
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ diff SavedMarinerPkg_ORIGINALS/ibus/ibus.spec SPECS-EXTENDED/ibus/ibus.spec  | wc
      0       0       0
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ vim SPECS-EXTENDED/ibus/ibus.spec 
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ 
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ diff SavedMarinerPkg_ORIGINALS/ibus/ibus.spec SPECS-EXTENDED/ibus/ibus.spec  | wc
      6      14     122
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ diff SavedMarinerPkg_ORIGINALS/ibus/ibus.spec SPECS-EXTENDED/ibus/ibus.spec 
17,18c17,18
< Version:        1.5.22
< Release:        9%{?dist}
---
> Version:        1.5.31
> Release:        1%{?dist}
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ 
```

Change Num 2 before next build try:

After the discussion in today's meeting, 
	a.  libtommath.spec was changed to have "~" replaced by a ".".  
	b.  Therefore, "Version: 1.3.1~rc1 became "Version: 1.3.1.rc1".  
	c.  Further the macro "version_no_tilde" was also replaced by "1.3.1.rc1".

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ diff ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson/output/fedora/specs/libtommath/libto
mmath.spec libtommath/libtommath.spec 
12,13c12,13
< Version:        1.3.1.rc1
< Release:        %autorelease
---
> Version:        1.3.1~rc1
> Release:        1
18,19c18
< Source0:        https://github.com/libtom/%{name}/archive/v%{version_no_tilde}.tar.gz#/%{name}-%{version_no_tilde}.tar.gz
< 
---
> Source0:        https://github.com/libtom/%{name}/archive/v1.3.1.rc1.tar.gz#/%{name}-1.3.1.rc1.tar.gz
69c68
< %autosetup -p1 -n %{name}-%{version_no_tilde}
---
> %autosetup -p1 -n %{name}-1.3.1.rc1
```

There was a question in my mind that 'libtommath' is not present in the package list to be compiled, then why is still it occuring in an error.
The thing is that the error is reported by "rpmssnapshot" tool.
This tool unlike the "srpmpacker" or other tools, doesn't take the package list as an argument.
So, "rpmssnapshot" might be using all the directories present in "SPECS-EXTENDED" and therefore landing with an error in "libtommath" as 
libtommath is still present in the "SPECS-EXTENDED" directory.


Change Num 3 before next build try:

Further as advised in the meeting today, replaced "fontpkgname1" etc. by the corresponding names of the real conf files in the spec file baekmuk-ttf-fonts.spec.
Therefore, this package will be added to the list of packages to be built.


```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ diff ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson/output/fedora/specs/baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec  ./SPECS-EXTENDED/baekmuk-ttf-fonts/
98,101c98,101
< Source11: 68-%{fontpkgname1}.conf
< Source12: 68-%{fontpkgname2}.conf
< Source13: 68-%{fontpkgname3}.conf
< Source14: 68-%{fontpkgname4}.conf
---
> Source11: 68-baekmuk-batang-fonts.conf
> Source12: 68-baekmuk-dotum-fonts.conf
> Source13: 68-baekmuk-gulim-fonts.conf
> Source14: 68-baekmuk-headline-fonts.conf
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ 
```


Change Num 4 before next build try:

As noted in the previous point, the package "baekmuk-ttf-fonts" will be added to the list of packages to be built.
So, this will be a change in the shell script ./binsrch_multitrgt.sh

Started the build with the above changes:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_3_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 357964
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    2m4.155s
user    0m0.012s
sys     0m0.004s
```

As seen in the console prints above, it failed within 2 minutes.

The build logs still showed the error related to libtommath.  Just that instead of a hyphen "-" a "~" was present in the word which was reported as not matching a regular expression.

```
INFO[0022][rpmssnapshot] The specs build 3783 packages in total.      
ERRO[0022][rpmssnapshot] Failed to generate snapshot from specs folder (../SPECS-EXTENDED) into (/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json). Error: failed to convert RPMs list to a packages summary file:
RPM package name (libtommath-1.3.1~rc1-1.x86_64) doesn't match the regular expression (^(.*)-([^-]+-[^-]+)\.([^.]+)\.([^.]+)$) 
cp /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json
cp: cannot stat '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpms_snapshots/SPECS-EXTENDED_rpms_snapshot.json': No such file or directory
make: *** [/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/toolkit.mk:94: /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/rpms_snapshot.json] Error 1
make: *** Waiting for unfinished jobs....
INFO[0031][srpmpacker] Calculating SPECs to repack                  
INFO[0032][srpmpacker] Skipping (/specs/j
```

Change Num 1 before next build try:

My plan is to remove libtommath from the SPECS-EXTENDED directory.
Do a make clean and see if this error can be put on a side burner.

There was an error related to ibus, but this time it was because of a Source file which was not present.  This is OK, I will remove the corresponding Source line from the ibus.spec file.
Actually, I was using the Mariner spec file of ibus by modifying only the Version and release tag.  But there may be other places, like this one which also might need some touch up.
The error was that specreader was unable to hydrate "ibus-HEAD.patch":

```
INFO[0055][srpmpacker] Skipping (/specs/beust-jcommander/beust-jcommander.spec) since it cannot be built on current architecture. 
INFO[0055][srpmpacker] Skipping (/specs/xbean/xbean.spec) since it cannot be built on current architecture. 
INFO[0058][srpmpacker] Packing 2/1494 SPECs                         
WARN[0058][srpmpacker] Updating signature for (68-baekmuk-batang-fonts.conf) from () to (ef94e3421eac3f7e73151e6a9ea3f5414a9196e8ddab4ad680542b4b9e5809c8) 
WARN[0058][srpmpacker] Updating signature for (68-baekmuk-dotum-fonts.conf) from () to (c543e6ff7ee4ab7d1b720cbb987a4d79eefb2be5db64af8ce80150ab29b058d6) 
WARN[0058][srpmpacker] Updating signature for (68-baekmuk-gulim-fonts.conf) from () to (1d8d1718f36336ec49f2bd7531dc9d35efa9fdbaaa1d8af6b842c8e37fb11e23) 
WARN[0058][srpmpacker] Updating signature for (68-baekmuk-headline-fonts.conf) from () to (097efeddc9f1c3d24142fb46d0a8aca7fd8914742cadbea6d51dbe38dc64506e) 
ERRO[0059][srpmpacker] Unable to hydrate file: ibus-HEAD.patch      
ERRO[0059][srpmpacker] Failed to pack (/specs/ibus/ibus.spec). Cancelling outstanding workers. Error: unable to hydrate files: [ibus-HEAD.patch] 
WARN[0059][srpmpacker] Updating signature for (baekmuk-ttf-2.2.tar.gz) from () to (08ab7dffb55d5887cc942ce370f5e33b756a55fbb4eaf0b90f244070e8d51882) 
INFO[0059][srpmpacker] Updating (/specs/baekmuk-ttf-fonts/baekmuk-ttf-fonts.signatures.json) 
WARN[0059][specreader] Found a boolean condition 'mrtg-selinux if selinux-policy-targeted', make sure the packages on the left is available. Please refer to 'docs/how_it_works/3_package_building.md#rich-dependencies' for explanation of limitations. 
WARN[0059][specreader] Found a boolean condition 'mrtg-selinux if selinux-policy-targeted', make sure the packages on the left is available. Please refer to 'docs/how_it_works/3_package_building.md#rich-dependencies' for explanation of limitations. 
PANI[0062][srpmpacker] unable to hydrate files: [ibus-HEAD.patch]   
panic: (*logrus.Entry) 0xc0000f2070
```


Change Num 2 before next build try:

The change in ibus.spec was carried out:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ git diff SPECS-EXTENDED/ibus/ibus.spec
diff --git a/SPECS-EXTENDED/ibus/ibus.spec b/SPECS-EXTENDED/ibus/ibus.spec
index 611983f14..8bb56beff 100644
--- a/SPECS-EXTENDED/ibus/ibus.spec
+++ b/SPECS-EXTENDED/ibus/ibus.spec
@@ -14,8 +14,8 @@ Distribution:   Azure Linux
 %global dbus_python_version 0.83.0
 
 Name:           ibus
-Version:        1.5.22
-Release:        9%{?dist}
+Version:        1.5.31
+Release:        1%{?dist}
 Summary:        Intelligent Input Bus for Linux OS
 License:        LGPLv2+
 URL:            https://github.com/ibus/%name/wiki
@@ -23,7 +23,7 @@ Source0:        https://github.com/ibus/%name/releases/download/%{version}/%{nam
 Source1:        %{name}-xinput
 Source2:        %{name}.conf.5
 # Patch0:         %%{name}-HEAD.patch
-Patch0:         %{name}-HEAD.patch
+#Patch0:         %{name}-HEAD.patch
 # Under testing #1349148 #1385349 #1350291 #1406699 #1432252 #1601577
 Patch1:         %{name}-1385349-segv-bus-proxy.patch
 
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ 
```


Carrying out the actions decided above:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ ls -d SPECS-EXTENDED/libtomm*/
SPECS-EXTENDED/libtommath/
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ rm -rf SPECS-EXTENDED/libtommath/
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ ls -d SPECS-EXTENDED/libtomm*/
ls: cannot access 'SPECS-EXTENDED/libtomm*/': No such file or directory
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ 
...
...
...
...
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ sudo make clean > /dev/null
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_4_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 484464
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    50m49.213s
user    0m0.017s
sys     0m0.001s
```

As we see, it failed after 50 minutes.
However, this time the errors related to libtommath, ibus and baekmuk-ttf-fonts were absent.

The logs show failure in downloading binutils package now.
```
INFO[0506][srpmpacker] Packed (cassandra.spec) -> (cassandra-4.0.10-1.azl3.src.rpm) 
INFO[1198][srpmpacker] Packed (google-noto-cjk-fonts.spec) -> (google-noto-cjk-fonts-20190416-7.azl3.src.rpm) 
Finished updating /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/INTERMEDIATE_SRPMS

ERROR: Failed to download toolchain package: binutils-debuginfo-2.41-2.azl3.x86_64.rpm.
ERROR: Last 20 lines from log '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/binutils-debuginfo-2.41-2.azl3.x86_64.rpm.log':
        Downloading toolchain RPM: binutils-debuginfo-2.41-2.azl3.x86_64.rpm
        https://mariner3dailydevrepo.blob.core.windows.net/daily-repo-3-0-20241119-x86-64/built_rpms_all/binutils-debuginfo-2.41-2.azl3.x86_64.rpm -> /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/binutils-debuginfo-2.41-2.azl3.x86_64.rpm.log.1
        FAILURE
        https://mariner3dailydevrepo.blob.core.windows.net/daily-repo-3-0-20241119-x86-64/binutils-debuginfo-2.41-2.azl3.x86_64.rpm -> /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/binutils-debuginfo-2.41-2.azl3.x86_64.rpm.log.2
        FAILURE
        https://packages.microsoft.com/azurelinux//prod/base/x86_64/binutils-debuginfo-2.41-2.azl3.x86_64.rpm -> /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/binutils-debuginfo-2.41-2.azl3.x86_64.rpm.log.3
        FAILURE
        https://packages.microsoft.com/azurelinux//prod/base/debuginfo/x86_64/binutils-debuginfo-2.41-2.azl3.x86_64.rpm -> /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/binutils-debuginfo-2.41-2.azl3.x86_64.rpm.log.4
        FAILURE
        https://packages.microsoft.com/azurelinux//prod/ms-oss/x86_64/binutils-debuginfo-2.41-2.azl3.x86_64.rpm -> /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/binutils-debuginfo-2.41-2.azl3.x86_64.rpm.log.5
        FAILURE
        No entries in PACKAGE_URL_LIST (https://mariner3dailydevrepo.blob.core.windows.net/daily-repo-3-0-20241119-x86-64/built_rpms_all https://mariner3dailydevrepo.blob.core.windows.net/daily-repo-3-0-20241119-x86-64 https://packages.microsoft.com/azurelinux//prod/base/x86_64 https://packages.microsoft.com/azurelinux//prod/base/debuginfo/x86_64 https://packages.microsoft.com/azurelinux//prod/ms-oss/x86_64) were able to provide the toolchain package: binutils-debuginfo-2.41-2.azl3.x86_64.rpm.
Toolchain download failed. See above errors for more details.
make: *** [/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/toolchain.mk:309: /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/toolchain_rpms/x86_64/binutils-debuginfo-2.41-2.azl3.x86_64.rpm] Error 1
```


We can see that the paths above do have a problem that 3.0 is missing as Azure Linux release.  Search for two consecutive / in the above error logs.  Something like 
"https://packages.microsoft.com/azurelinux//prod/" will be seen.
That is between "azurelinux" and "prod" there is a missing word "3.0".

This can be fixed with "PACKAGE_URL_LIST" and "RELEASE_MAJOR_ID" environment variables.

Ideally this shouldn't have occurred since we were building after a "make clean".  Therefore, instead of using the environment variable "", we will simply trigger the build again.


```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_5_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 660166
```

This time it failed again.
After consultation with Falak, trying the following steps:
make clean
reboot the VM
then start the build

Therefore, first did make clean and then rebooted the VM and then gave the following build:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_mult
itrgt.sh > ../bld_binsrch_minus_tommath_6_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 1363
```

This time the build failed with an error that "noto-cjk-be6c059.tar.gz" for the "google-noto-cjk-fonts" could not be downloaded.

```
6499 ^[[36mINFO^[[0m[0163][srpmpacker] Packed (cassandra.spec) -> (cassandra-4.0.10-1.azl3.src.rpm)
6500 ^[[36mINFO^[[0m[0237][srpmpacker] Packed (kernel-rt.spec) -> (kernel-rt-6.6.44.1-1.azl3.src.rpm)
6501 ^[[36mINFO^[[0m[0691][srpmpacker] Attempt 1/8: Failed to download (https://azurelinuxsrcstorage.blob.core.windows.net/sources/core/noto-cjk-be6c059.tar.gz) with error: (read tcp 192.168.225.5:50554->20.     209.1.65:443: read: connection reset by peer)
6502 ^[[31mERRO^[[0m[0691][srpmpacker] Failed to pack (/specs/google-noto-cjk-fonts/google-noto-cjk-fonts.spec). Cancelling outstanding workers. Error: packer cancel signal received
6503 ^[[31mPANI^[[0m[1688][srpmpacker] packer cancel signal received
6504 panic: (*logrus.Entry) 0xc000200070
6505 
6506 goroutine 1 [running]:
6507 github.com/sirupsen/logrus.(*Entry).log(0xc000200000, 0x0, {0xc0001525e0, 0x1d})
```

The investigation has revealed the following:
1. The tar.gz name expected is correct.  This can be verified by considering how the macros used in "Version:" tag of google-noto-cjk-fonts.spec would expand.
2. The tar.gz file "noto-cjk-be6c059.tar.gz" was not there on "https://packages.microsoft.com/azurelinux/3.0/prod/".  So, the error we see in our build logs
   must be correct that this file could not be downloaded.
3. Checked the daily build of 06 Nov, 2024.  There also the build has failed for this package "google-noto-cjk-fonts".


Change Num 1 before next build try:
1. Going to remove google-noto-cjk-fonts from the list of the packages to be built.
2. Do a make clean
3. Then rebuild 


```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_mult
itrgt.sh > bld_binsrch_minus_tommath_7_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 1380
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    21m20.804s
user    0m0.017s
sys     0m0.010s
```

The build failed after 21 minutes.

Two important parts of the log are captured below.
1.  There was the following error seen related to boolean conditions in spec files requiring both of the packages 
    mentioned in an or condition to be available for the purpose of 
    the completion of the graph making step.  
    I am not sure if this will break the build down the line.  
    Allowed the build to continue.  The build stopped when the events mentioned in the next point happened, which was recorded as a panic (PANI[0000][grapher].
2.  There was a Panic, reported by grapher that it had failed to add a local package pcp-pmda-openmetrics which provides the capability pcp-pmda-prometheus 
    and is a sub-package of pcp.  The thing mentioned in this part of the logs is that the pcp-pmda-openmetrics-6.3.1-1.azl3.x86_64.rpm is a run node and can't have double conditionals.

```
WARN[0102][precacher] Could not find 'pcp-pmda-cisco-6.3.1-1.azl3.x86_64.rpm' in any repos 
WARN[0102][precacher] Could not find 'python3-colorama-0.4.6-9.azl3.noarch.rpm' in any repos 
INFO[0102][precacher] Pre-caching: 100% ( downloaded:    0, skipped:    0, unavailable: 3779, failed:    0 ) 
INFO[0102][precacher] Downloaded 0 packages into the cache         
INFO[0102][precacher] Writing summary file to '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/precache/downloaded_files.txt' 
WARN[0104][specreader] Found a boolean condition 'systemd-standalone-tmpfiles or systemd', make sure both packages are available. Please refer to 'docs/how_it_works/3_package_building.md#rich-dependencies' for explanation of limitations. 
WARN[0104][specreader] Found a boolean condition 'systemd-standalone-tmpfiles or systemd', make sure both packages are available. Please refer to 'docs/how_it_works/3_package_building.md#rich-dependencies' for explanation of limitations. 
<snip>
<snip>
<snip>
<snip>
WARN[0000][grapher] Skipping duplicate package name for package pcmk-cluster-manager:C:'='V:'2.1.9-1.azl3',C2:''V2:'' read from SRPM (/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/INTERMEDIATE_SRPMS/pacemaker-2.1.9-1.azl3.src.rpm). Original: pcmk-cluster-manager(=2.1.9-1.azl3,):<ID:7934 Type:Run State:Meta Rpm:/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/RPMS/x86_64/pacemaker-2.1.9-1.azl3.x86_64.rpm> from '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/INTERMEDIATE_SRPMS/pacemaker-2.1.9-1.azl3.src.rpm' in '<LOCAL_REPO>' 
PANI[0000][grapher] failed to add local package &{Provides:pcp-pmda-prometheus:C:'<'V:'5.0.0',C2:''V2:'' SrpmPath:/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/INTERMEDIATE_SRPMS/pcp-6.3.1-1.azl3.src.rpm RpmPath:/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/RPMS/x86_64/pcp-pmda-openmetrics-6.3.1-1.azl3.x86_64.rpm SourceDir:/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED/pcp SpecPath:/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED/pcp/pcp.spec Architecture:x86_64 Requires:[/bin/sh:C:''V:'',C2:''V2:'' pcp-libs:C:'='V:'6.3.1-1.azl3',C2:''V2:'' pcp:C:'='V:'6.3.1-1.azl3',C2:''V2:'' python3-pcp:C:''V:'',C2:''V2:'' python3-requests:C:''V:'',C2:''V2:''] BuildRequires:[/bin/hostname:C:''V:'',C2:''V2:'' /bin/ps:C:''V:'',C2:''V2:'' autoconf:C:''V:'',C2:''V2:'' avahi-devel:C:''V:'',C2:''V2:'' bison:C:''V:'',C2:''V2:'' cyrus-sasl-devel:C:''V:'',C2:''V2:'' desktop-file-utils:C:''V:'',C2:''V2:'' device-mapper-devel:C:''V:'',C2:''V2:'' flex:C:''V:'',C2:''V2:'' gcc:C:''V:'',C2:''V2:'' gcc-c++:C:''V:'',C2:''V2:'' hicolor-icon-theme:C:''V:'',C2:''V2:'' libibmad-devel:C:'>='V:'1.3.7',C2:''V2:'' libibumad-devel:C:'>='V:'1.3.7',C2:''V2:'' libvirt-python3:C:''V:'',C2:''V2:'' make:C:''V:'',C2:''V2:'' ncurses-devel:C:''V:'',C2:''V2:'' openssl-devel:C:'>='V:'1.1.1',C2:''V2:'' perl(DBD::mysql):C:''V:'',C2:''V2:'' perl(DBI):C:''V:'',C2:''V2:'' perl(Digest::MD5):C:''V:'',C2:''V2:'' perl(ExtUtils::MakeMaker):C:''V:'',C2:''V2:'' perl(File::Slurp):C:''V:'',C2:''V2:'' perl(JSON):C:''V:'',C2:''V2:'' perl(LWP::UserAgent):C:''V:'',C2:''V2:'' perl(Time::HiRes):C:''V:'',C2:''V2:'' perl(XML::LibXML):C:''V:'',C2:''V2:'' perl(strict):C:''V:'',C2:''V2:'' perl-devel:C:''V:'',C2:''V2:'' perl-generators:C:''V:'',C2:''V2:'' postfix:C:''V:'',C2:''V2:'' procps:C:''V:'',C2:''V2:'' python-devel:C:''V:'',C2:''V2:'' python3-devel:C:''V:'',C2:''V2:'' python3-jsonpointer:C:''V:'',C2:''V2:'' python3-lxml:C:''V:'',C2:''V2:'' python3-psycopg2:C:''V:'',C2:''V2:'' python3-pymongo:C:''V:'',C2:''V2:'' python3-pyodbc:C:''V:'',C2:''V2:'' python3-requests:C:''V:'',C2:''V2:'' python3-rtslib:C:''V:'',C2:''V2:'' python3-setuptools:C:''V:'',C2:''V2:'' python3-six:C:''V:'',C2:''V2:'' qt5-qtbase-devel:C:''V:'',C2:''V2:'' qt5-qtsvg-devel:C:''V:'',C2:''V2:'' readline-devel:C:''V:'',C2:''V2:'' systemtap-sdt-devel:C:''V:'',C2:''V2:'' xz-devel:C:''V:'',C2:''V2:'' zlib-devel:C:''V:'',C2:''V2:''] TestRequires:[] IsToolchain:false RunTests:false}:
pcp-pmda-prometheus(<5.0.0,):<ID:8230 Type:Run State:Meta Rpm:/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/RPMS/x86_64/pcp-pmda-openmetrics-6.3.1-1.azl3.x86_64.rpm> from '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/INTERMEDIATE_SRPMS/pcp-6.3.1-1.azl3.src.rpm' in '<LOCAL_REPO>' is a run node and can't have double conditionals 
```

On analysis found that the spec file "pcp.spec" has conditions like the following:

```
   8 Source0: https://github.com/performancecopilot/pcp/releases/pcp-%{version}.src.tar.gz
   9 %if 0%{?fedora} >= 40 || 0%{?rhel} >= 10                                                          
  10 ExcludeArch: %{ix86}                                                                              
  11 %endif                                                                                            
  12                                                                                                   
  13 # The additional linker flags break out-of-tree PMDAs.                                            
  14 # https://bugzilla.redhat.com/show_bug.cgi?id=2043092                                             
  15 %undefine _package_note_flags                                                                     
  16                                                                                                   
  17 %if 0%{?fedora} >= 26 || 0%{?rhel} > 7                                                            
  18 %global __python2 python2                                                                         
  19 %else                                                                                             
  20 %global __python2 python                                                                          
  21 %endif                                                                                            
  22                                                                                                   
  23 # UsrMerge was completed in EL 7, however the latest 'hostname' package in EL 7 contains "Provides: /bin/hostname".  Likewise for /bin/ps from procps[-ng] packages.
  24 %if 0%{?rhel} >= 8 || 0%{?fedora} >= 17 
  25 %global _hostname_executable /usr/bin/hostname                                                    
  26 %global _ps_executable /usr/bin/ps
  27 %else
  28 %global _hostname_executable /bin/hostname                                                        
  29 %global _ps_executable /bin/ps
  30 %endif
  ```

Or there might be some other thing that the grapher is pointing out as the multiple conditionals.

Change Num 1 before next build try:

Therefore, lets try using the Mariner file, such that it is updated with the new version.

The spec file was changed as follows:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED/pcp ]$ git diff pcp.spec
diff --git a/SPECS-EXTENDED/pcp/pcp.spec b/SPECS-EXTENDED/pcp/pcp.spec
index 1c798a2a8..6459cb547 100644
--- a/SPECS-EXTENDED/pcp/pcp.spec
+++ b/SPECS-EXTENDED/pcp/pcp.spec
@@ -1,8 +1,8 @@
 %global _unpackaged_files_terminate_build 0
 
 Name:    pcp
-Version: 5.1.1
-Release: 3%{?dist}
+Version: 6.3.1
+Release: 1%{?dist}
 Summary: System-level performance monitoring and performance management
 License: GPLv2+ and LGPLv2+ and CC-BY
 Vendor:         Microsoft Corporation
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED/pcp ]$ 
```

We will follow the rigorous steps of 
1. reboot VM
2. make clean
3. then build

Started the build after the above steps:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_9_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 2562
```

It failed after about 4 hours of build.  The error was that gcc-debuginfo could not be downloaded:

```
INFO[0219][srpmpacker] Packed (kernel-rt.spec) -> (kernel-rt-6.6.44.1-1.azl3.src.rpm) 
INFO[0220][srpmpacker] Packed (pmdk-convert.spec) -> (pmdk-convert-1.7-3.azl3.src.rpm) 
INFO[0432][srpmpacker] Packed (delve.spec) -> (delve-1.5.0-16.azl3.src.rpm) 
INFO[0476][srpmpacker] Packed (cassandra.spec) -> (cassandra-4.0.10-1.azl3.src.rpm) 
Finished updating /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/INTERMEDIATE_SRPMS

ERROR: Failed to download toolchain package: gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm.
ERROR: Last 20 lines from log '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm.log':
        Downloading toolchain RPM: gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm
        https://mariner3dailydevrepo.blob.core.windows.net/daily-repo-3-0-20241121-x86-64/built_rpms_all/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm -> /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm.log.1
        FAILURE
        https://mariner3dailydevrepo.blob.core.windows.net/daily-repo-3-0-20241121-x86-64/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm -> /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm.log.2
        FAILURE
        https://packages.microsoft.com/azurelinux//prod/base/x86_64/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm -> /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm.log.3
        FAILURE
        https://packages.microsoft.com/azurelinux//prod/base/debuginfo/x86_64/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm -> /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm.log.4
        FAILURE
        https://packages.microsoft.com/azurelinux//prod/ms-oss/x86_64/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm -> /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/logs/toolchain/downloads/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm.log.5
        FAILURE
        No entries in PACKAGE_URL_LIST (https://mariner3dailydevrepo.blob.core.windows.net/daily-repo-3-0-20241121-x86-64/built_rpms_all https://mariner3dailydevrepo.blob.core.windows.net/daily-repo-3-0-20241121-x86-64 https://packages.microsoft.com/azurelinux//prod/base/x86_64 https://packages.microsoft.com/azurelinux//prod/base/debuginfo/x86_64 https://packages.microsoft.com/azurelinux//prod/ms-oss/x86_64) were able to provide the toolchain package: gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm.
Toolchain download failed. See above errors for more details.
make: *** [/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/toolchain.mk:309: /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/toolchain_rpms/x86_64/gcc-debuginfo-13.2.0-7.azl3.x86_64.rpm] Error 1
```

22 Nov 2024
===========

Started from the above state by simply re-running the build.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_10_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 213796
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    20m46.728s
user    0m0.017s
sys     0m0.011s
```


This time it failed with the following "circular dependency" error:
```
INFO[0001][grapher] Adding unresolved node (perl(Devel::LexAlias)--REMOTE<Unresolved>) 
INFO[0001][grapher] Adding unresolved node (perl(PadWalker)--REMOTE<Unresolved>) 
INFO[0001][grapher] Adding unresolved node (perl(Email::Date::Format)--REMOTE<Unresolved>) 
INFO[0001][grapher] Adding unresolved node (perl(MIME::Types)--REMOTE<Unresolved>) 
INFO[0001][grapher] Adding unresolved node (perl(Inline::C)--REMOTE<Unresolved>) 
INFO[0001][grapher]     Added 94625 dependencies                    
INFO[0001][grapher] Running cycle resolution to fix any cycles in the dependency graph 
INFO[0001][grapher] Trying to fix circular dependency found:    {ibus-table-chinese-stroke5-1.8.12-6.azl3-BUILD<Build>} --> {ibus-table-chinese-stroke5-1.8.12-6.azl3-RUN<Meta>} --> {ibus-table-devel-1.17.8-1.azl3-BUILD<Build>} --> {ibus-table-devel-1.17.8-1.azl3-RUN<Meta>} 
WARN[0001][grapher] â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— 
WARN[0001][grapher] â•‘  'copy-toolchain-rpms' should no longer be required to resolve cycles even when using online  â•‘ 
WARN[0001][grapher] â•‘ toolchain rpms. If you see this message, there is likely a legitimate cycle in the dependency â•‘ 
WARN[0001][grapher] â•‘                                            graph.                                             â•‘ 
WARN[0001][grapher] â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 
PANI[0001][grapher] unfixable circular dependency in dependency graph ({ibus-table-devel-1.17.8-1.azl3-RUN<Meta>} --> {ibus-table-chinese-stroke5-1.8.12-6.azl3-BUILD<Build>} --> {ibus-table-chinese-stroke5-1.8.12-6.azl3-RUN<Meta>} --> {ibus-table-devel-1.17.8-1.azl3-BUILD<Build>} --> {ibus-table-devel-1.17.8-1.azl3-RUN<Meta>}):
cycle can't be resolved with prebuilt/PMC RPMs. Unresolvable 
panic: (*logrus.Entry) 0xc0001d51f0

goroutine 1 [running]:
```


The two packages don't have circular dependency in the Mariner 3.0-dev code base.
Checked this by running "depsearch" for pkg_artifacts of 06 Nov.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ go run depsearch.go --input=/home/neerajs/Downloads/daily_builds/06Nov2024/built_graph.dot --specs="ibus-table"
WARN[0000][depsearch] Default toolchain filter file (./resources/manifests/package/toolchain_x86_64.txt) not found, setting to '' 
INFO[0000][depsearch] Filter file () not applicable here           
INFO[0000][depsearch] Reading DOT graph from /home/neerajs/Downloads/daily_builds/06Nov2024/built_graph.dot 
INFO[0000][depsearch] Found 3 nodes to consider                    
INFO[0000][depsearch] Forward search will list all dependants which rely on any of the provided packages 
INFO[0002][depsearch] Scanned 0 nodes                              
ibus-table
ibus-table-chinese
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ go run depsearch.go --input=/home/neerajs/Downloads/daily_builds/06Nov2024/built_graph.dot --specs="ibus-table-chinese"
WARN[0000][depsearch] Default toolchain filter file (./resources/manifests/package/toolchain_x86_64.txt) not found, setting to '' 
INFO[0000][depsearch] Filter file () not applicable here           
INFO[0000][depsearch] Reading DOT graph from /home/neerajs/Downloads/daily_builds/06Nov2024/built_graph.dot 
INFO[0001][depsearch] Found 24 nodes to consider                   
INFO[0001][depsearch] Forward search will list all dependants which rely on any of the provided packages 
INFO[0002][depsearch] Scanned 0 nodes                              
ibus-table-chinese
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$
```


But indeed for the latest versions of these packages that we are trying to build for the upgrade, the dependency is circular:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ rpm -qp --requires /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/INTERMEDIATE_SRPMS/ibus-tab
le-chinese-1.8.12-6.azl3.src.rpm
cmake >= 3.0.0
ibus-table-devel >= 1.10.0
make
rpmlib(CompressedFileNames) <= 3.0.4-1
rpmlib(FileDigests) <= 4.6.0-1
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ rpm -qp --requires /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/INTERMEDIATE_SRPMS/ibus-table-1.17.8-1.azl3.src.rpm 
dbus-x11
desktop-file-utils
docbook-utils
gcc
ibus-devel > 1.3.0
ibus-table-chinese-cangjie
ibus-table-chinese-stroke5
ibus-table-chinese-wubi-jidian
ibus-table-code
ibus-table-latin
ibus-table-translit
ibus-table-tv
libappstream-glib
make
python3-devel >= 3.6.0
python3-gobject
python3-gobject-base
rpmlib(CompressedFileNames) <= 3.0.4-1
rpmlib(FileDigests) <= 4.6.0-1
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ 
```

As discussed with Maruthi and Bala, first I will try placing the two packages directly inside the "..../build/rpm_cache/cache/" directory.

Doing the same:
```
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ wget https://packages.microsoft.com/cbl-mariner/2.0/prod/extended/x86_64/Packages/i/ibus-table-1.12.4-4.cm2.noarch.rpm https://packages.microsoft.com/cbl-mariner/2.0/prod/extended/x86_64/Packages/i/ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
ibus-table-1.12.4-4. 100% [============================================================================================================================================================>]    1.03M    2.70MB/s
ibus-table-chinese-s 100% [============================================================================================================================================================>]  434.73K    2.44MB/s
                          [Files: 2  Bytes: 1.45M [125.74KB/s] Redirects: 0  Todo: 0  Errors: 0                                                                                         ]
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ pwd
/home/neerajs/Downloads/packages_random
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ ls
ibus-table-1.12.4-4.cm2.noarch.rpm  ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ cp *.rpm /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache/
cp: cannot create regular file '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache/ibus-table-1.12.4-4.cm2.noarch.rpm': Permission denied
cp: cannot create regular file '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache/ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm': Permission denied
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ sudo cp *.rpm /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache/
[sudo] password for neerajs: 
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ 
<snip>
<snip>
<snip>
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ ls
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ ls
ibus-table-1.12.4-4.cm2.noarch.rpm  ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$
```

Building the packages again:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_11_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 221122
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    1m18.700s
user    0m0.007s
sys     0m0.013s
```

It finished under 2 minutes.
The circular dependency error of ibus-table-devel and ibus-table-chinese-stroke5 was resolved.

But there was a new circular dependency reported for "fltk-fluid-1.3.8-10.azl3"

Will do the same, i.e. download "fltk-fluid-1.3.8-10.azl3" and keep it in rpm_cache/cache.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ ls
ibus-table-1.12.4-4.cm2.noarch.rpm  ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
<snip>
<snip>
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ ls
ibus-table-1.12.4-4.cm2.noarch.rpm  ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ wget https://packages.microsoft.com/azurelinux/3.0/prod/extended/x86_64/Packages/f/fltk-fluid-1.3.5-4.azl3.x86_64.rpm
fltk-fluid-1.3.5-4.a 100% [============================================================================================================================================================>]  248.36K    --.-KB/s
                          [Files: 1  Bytes: 248.36K [587.14KB/s] Redirects: 0  Todo: 0  Errors: 0                                                                                       ]
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ ls
fltk-fluid-1.3.5-4.azl3.x86_64.rpm  ibus-table-1.12.4-4.cm2.noarch.rpm  ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ sudo cp fltk-fluid-1.3.5-4.azl3.x86_64.rpm /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache/
[sudo] password for neerajs: 
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ 
<snip>
<snip>
<snip>
<snip>
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ ls
ibus-table-1.12.4-4.cm2.noarch.rpm  ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$
```

Started the build again:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_12_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 221607
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    1m8.226s
user    0m0.006s
sys     0m0.013s
```

The error occurred again.

```
INFO[0001][grapher]     Added 94625 dependencies                    
INFO[0001][grapher] Running cycle resolution to fix any cycles in the dependency graph 
INFO[0001][grapher] Trying to fix circular dependency found:    {fltk-fluid-1.3.8-10.azl3-BUILD<Build>} --> {fltk-fluid-1.3.8-10.azl3-RUN<Meta>} 
WARN[0001][grapher] â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— 
WARN[0001][grapher] â•‘  'copy-toolchain-rpms' should no longer be required to resolve cycles even when using online  â•‘ 
WARN[0001][grapher] â•‘ toolchain rpms. If you see this message, there is likely a legitimate cycle in the dependency â•‘ 
WARN[0001][grapher] â•‘                                            graph.                                             â•‘ 
WARN[0001][grapher] â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 
PANI[0001][grapher] unfixable circular dependency in dependency graph ({fltk-fluid-1.3.8-10.azl3-RUN<Meta>} --> {fltk-fluid-1.3.8-10.azl3-BUILD<Build>} --> {fltk-fluid-1.3.8-10.azl3-RUN<Meta>}):
cycle can't be resolved with prebuilt/PMC RPMs. Unresolvable 
panic: (*logrus.Entry) 0xc00030aa10
```

Looking into the spec file fltk-fluid.spec found that there is a BuildRequires of fltk-fluid on fltk-fluid itself.
```
29 BuildRequires:  cmake
 30 BuildRequires:  desktop-file-utils
 31 BuildRequires:  doxygen
 32 # For MinGW builds
 33 BuildRequires:  fltk-fluid
 34 BuildRequires:  gcc-c++
 35 BuildRequires:  make
 36 BuildRequires:  texlive-latex
```

Therefore, going to try commenting out this dependency:

```
 31 BuildRequires:  doxygen
 32 # For MinGW builds
 33 #BuildRequires:  fltk-fluid
 34 BuildRequires:  gcc-c++
 35 BuildRequires:  make
 36 BuildRequires:  texlive-latex
```


Started the build again:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_13_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 222103
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    2m7.907s
user    0m0.006s
sys     0m0.013s
```

It failed with a circular dependency reported between "ibus-table-chinese-wubi-jidian-1.8.12-6.azl3-" and "ibus-table-devel-1.17.8-1.azl3-".

```
INFO[0001][grapher]     Added 94603 dependencies                    
INFO[0001][grapher] Running cycle resolution to fix any cycles in the dependency graph 
INFO[0001][grapher] Trying to fix circular dependency found:    {ibus-table-chinese-wubi-jidian-1.8.12-6.azl3-BUILD<Build>} --> {ibus-table-chinese-wubi-jidian-1.8.12-6.azl3-RUN<Meta>} --> {ibus-table-devel-1.17.8-1.azl3-BUILD<Build>} --> {ibus-table-devel-1.17.8-1.azl3-RUN<Meta>} 
WARN[0001][grapher] â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— 
WARN[0001][grapher] â•‘  'copy-toolchain-rpms' should no longer be required to resolve cycles even when using online  â•‘ 
WARN[0001][grapher] â•‘ toolchain rpms. If you see this message, there is likely a legitimate cycle in the dependency â•‘ 
WARN[0001][grapher] â•‘                                            graph.                                             â•‘ 
WARN[0001][grapher] â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 
PANI[0001][grapher] unfixable circular dependency in dependency graph ({ibus-table-devel-1.17.8-1.azl3-RUN<Meta>} --> {ibus-table-chinese-wubi-jidian-1.8.12-6.azl3-BUILD<Build>} --> {ibus-table-chinese-wubi-jidian-1.8.12-6.azl3-RUN<Meta>} --> {ibus-table-devel-1.17.8-1.azl3-BUILD<Build>} --> {ibus-table-devel-1.17.8-1.azl3-RUN<Meta>}):
```

Will try build after downloading these and placing them in the build/rpm_cache/cache directory.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ ls
fltk-fluid-1.3.5-4.azl3.x86_64.rpm  ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
ibus-table-1.12.4-4.cm2.noarch.rpm
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ 
<snip>
<snip>
<snip>
<snip>
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ ls
fltk-fluid-1.3.5-4.azl3.x86_64.rpm  ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
ibus-table-1.12.4-4.cm2.noarch.rpm
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ wget https://packages.microsoft.com/cbl-mariner/2.0/prod/extended/x86_64/Packages/i/ibus-table-chinese-wubi-jidian-1.8.3-3.cm2.noarch.rpm
ibus-table-chinese-w 100% [==================================================>]    4.38M    1.12MB/s
                          [Files: 1  Bytes: 4.38M [688.72KB/s] Redirects: 0  T]
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ ls
fltk-fluid-1.3.5-4.azl3.x86_64.rpm  ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
ibus-table-1.12.4-4.cm2.noarch.rpm  ibus-table-chinese-wubi-jidian-1.8.3-3.cm2.noarch.rpm
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ sudo cp ibus-table-chinese-wubi-jidian-1.8.3-3.cm2.
noarch.rpm /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache
[sudo] password for neerajs: 
neerajs@azuli-m1 [ ~/Downloads/packages_random ]$ 
<snip>
<snip>
<snip>
<snip>
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ ls
fltk-fluid-1.3.5-4.azl3.x86_64.rpm  ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
ibus-table-1.12.4-4.cm2.noarch.rpm  ibus-table-chinese-wubi-jidian-1.8.3-3.cm2.noarch.rpm
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ 
```

Started the build:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_14_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 342286
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    1m6.052s
user    0m0.016s
sys     0m0.006s
```


As we see, the build failed within two minutes.


This time there was another circular dependency, between "ibus-table-devel-1.17.8-1.azl3- " and "ibus-table-chinese-cangjie-1.8.12-6.azl3-":

```
INFO[0001][grapher] Running cycle resolution to fix any cycles in the dependency graph 
INFO[0002][grapher] Trying to fix circular dependency found:    {ibus-table-chinese-cangjie-1.8.12-6.azl3-BUILD<Build>} --> {ibus-table-chinese-cangjie-1.8.12-6.azl3-RUN<Meta>} --> {ibus-table-devel-1.17.8-1.azl3-BUILD<Build>} --> {ibus-table-devel-1.17.8-1.azl3-RUN<Meta>} 
WARN[0002][grapher] â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— 
WARN[0002][grapher] â•‘  'copy-toolchain-rpms' should no longer be required to resolve cycles even when using online  â•‘ 
WARN[0002][grapher] â•‘ toolchain rpms. If you see this message, there is likely a legitimate cycle in the dependency â•‘ 
WARN[0002][grapher] â•‘                                            graph.                                             â•‘ 
WARN[0002][grapher] â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 
PANI[0002][grapher] unfixable circular dependency in dependency graph ({ibus-table-devel-1.17.8-1.azl3-RUN<Meta>} --> {ibus-table-chinese-cangjie-1.8.12-6.azl3-BUILD<Build>} --> {ibus-table-chinese-cangjie-1.8.12-6.azl3-RUN<Meta>} --> {ibus-table-devel-1.17.8-1.azl3-BUILD<Build>} --> {ibus-table-devel-1.17.8-1.azl3-RUN<Meta>}):
cycle can't be resolved with prebuilt/PMC RPMs. Unresolvable 
panic: (*logrus.Entry) 0xc0002fdb20
```

We already have "ibus-table-devel-1.17.8-1.azl3-" downloaded into the rpm_cache/cache folder.
We will bring in "ibus-table-chinese-cangjie-1.8.12-6.azl3- " this time.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ ls
fltk-fluid-1.3.5-4.azl3.x86_64.rpm  ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
ibus-table-1.12.4-4.cm2.noarch.rpm  ibus-table-chinese-wubi-jidian-1.8.3-3.cm2.noarch.rpm
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ sudo wget https://packages.microsoft.com/cbl-mariner/2.0/prod/extended/x86_64/Packages/i/ibus-table-chinese-cangjie-1.8.3-3.cm2.noarch.rpm
[sudo] password for neerajs: 
ibus-table-chinese-c 100% [==================================================>]    2.33M   21.54MB/s
                          [Files: 1  Bytes: 2.33M [4.83MB/s] Redirects: 0  Tod]
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ ls
fltk-fluid-1.3.5-4.azl3.x86_64.rpm
ibus-table-1.12.4-4.cm2.noarch.rpm
ibus-table-chinese-cangjie-1.8.3-3.cm2.noarch.rpm
ibus-table-chinese-stroke5-1.8.3-3.cm2.noarch.rpm
ibus-table-chinese-wubi-jidian-1.8.3-3.cm2.noarch.rpm
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ 
```


Started the build again:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_15_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 342740
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
```

It failed.
This time the circular depedency reported a repeat package "ibus-table-chinese-wubi-jidian-1.8.12-6 ".

```
WARN[0001][grapher] Resolving 'lua:C:'>='V:'5.1',C2:''V2:''' to remote node 'lua(>=%{lua_version},):<ID:14792 Type:Remote State:Unresolved Rpm:<NO_RPM_PATH>> from '<NO_SRPM_PATH>' in '<NO_SOURCE_REPO>'' instead of local node 'lua(=5.1,):<ID:6632 Type:Run State:Meta Rpm:/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/out/RPMS/x86_64/compat-lua-5.1.5-26.azl3.x86_64.rpm> from '/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/INTERMEDIATE_SRPMS/compat-lua-5.1.5-26.azl3.src.rpm' in '<LOCAL_REPO>'' 
INFO[0001][grapher] Adding unresolved node (perl(PPI::Util)--REMOTE<Unresolved>) 
INFO[0001][grapher] Adding unresolved node (perl(PPIx::Utils)--REMOTE<Unresolved>) 
INFO[0001][grapher] Adding unresolved node (perl(File::Find::Object::Rule)--REMOTE<Unresolved>) 
INFO[0001][grapher]     Added 94603 dependencies                    
INFO[0001][grapher] Running cycle resolution to fix any cycles in the dependency graph 
INFO[0001][grapher] Trying to fix circular dependency found:    {ibus-table-chinese-wubi-jidian-1.8.12-6.azl3-BUILD<Build>} --> {ibus-table-chinese-wubi-jidian-1.8.12-6.azl3-RUN<Meta>} --> {ibus-table-devel-1.17.8-1.azl3-BUILD<Build>} --> {ibus-table-devel-1.17.8-1.azl3-RUN<Meta>} 
WARN[0001][grapher] â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— 
WARN[0001][grapher] â•‘  'copy-toolchain-rpms' should no longer be required to resolve cycles even when using online  â•‘ 
WARN[0001][grapher] â•‘ toolchain rpms. If you see this message, there is likely a legitimate cycle in the dependency â•‘ 
WARN[0001][grapher] â•‘                                            graph.                                             â•‘ 
WARN[0001][grapher] â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 
PANI[0001][grapher] unfixable circular dependency in dependency graph ({ibus-table-devel-1.17.8-1.azl3-RUN<Meta>} --> {ibus-table-chinese-wubi-jidian-1.8.12-6.azl3-BUILD<Build>} --> {ibus-table-chinese-wubi-jidian-1.8.12-6.azl3-RUN<Meta>} --> {ibus-table-devel-1.17.8-1.azl3-BUILD<Build>} --> {ibus-table-devel-1.17.8-1.azl3-RUN<Meta>}):
cycle can't be resolved with prebuilt/PMC RPMs. Unresolvable 
panic: (*logrus.Entry) 0xc0000f7ce0
```

This means that the copy into rpm_cache/cache did not help????

Will therefore, go ahead and change the ibus-table.spec file to remove the mention of dependency on these ibus-table-chinese-* packages.  These are introducing circular dependencies.

Change Num 1 before next build try:
Carried out the change:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ diff ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson/output/fedora/specs/ibus-table/ibus-table.spec
 SPECS-EXTENDED/ibus-table/ibus-table.spec 
35,37c35,37
< BuildRequires:  ibus-table-chinese-wubi-jidian
< BuildRequires:  ibus-table-chinese-cangjie
< BuildRequires:  ibus-table-chinese-stroke5
---
> #BuildRequires:  ibus-table-chinese-wubi-jidian
> #BuildRequires:  ibus-table-chinese-cangjie
> #BuildRequires:  ibus-table-chinese-stroke5
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$
```


Started the build after the above changes:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_16_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 343432
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    137m32.287s
user    0m0.016s
sys     0m0.002s
```

It failed after 2 hrs 17 minutes.

The last few lines of the build log say that graphpkgfetcher failed to download delta RPMs.
One package "aopalliance" was reported as not fetched.

```
INFO[8124][graphpkgfetcher] (Cache progress 99%): choosing (postfix-perl-scripts-3.9.0-2.azl3.x86_64.rpm) to provide (postfix-perl-scripts) 
INFO[8124][graphpkgfetcher] (Cache progress 99%): choosing (ruby-3.3.3-2.azl3.x86_64.rpm) to provide (ruby(release)) 
INFO[8124][graphpkgfetcher] (Cache progress 99%): choosing (zstd-devel-1.5.5-2.azl3.x86_64.rpm) to provide (libzstd-devel) 
INFO[8124][graphpkgfetcher] Attempting to download delta RPMs for build nodes 
FATA[8125][graphpkgfetcher] Failed to fetch packages:
failed to download delta RPMs:
failed to generate package build list to calculate delta downloads:
failed to find nodes for the packages from the re-built list:
failed to find package (aopalliance) in the dependency graph 
INFO[8125][graphpkgfetcher] Waiting for outstanding chroot initialization and cleanup to finish 
INFO[8125][graphpkgfetcher] Waiting for outstanding chroot commands to finish 
INFO[8125][graphpkgfetcher] Waiting for outstanding processes to be created before blocking all future processes 
INFO[8125][graphpkgfetcher] Waiting for outstanding processes to be created before stopping all child processes 
INFO[8125][graphpkgfetcher] Cleaning up all active chroots               
INFO[8125][graphpkgfetcher] Cleanup finished                             
make: *** [/sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/scripts/pkggen.mk:206: /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/pkg_artifacts/cached_graph.dot] Error 1
```

Looking for more information in the log file there is an error which says that aopalliance cannot be built on the current architecture.


```
../bld_binsrch_minus_tommath_16_20241122-0833.log:155:INFO[0062][srpmpacker] Skipping (/specs/aopalliance/aopalliance.spec) since it cannot be built on current architecture.
```


Recall that we had come across this when Jagadeesh was working on aopalliance.
There is an ExclusiveArch tag which is causing this problem.

```
  9 URL:            http://aopalliance.sourceforge.net/
 10 BuildArch:      noarch
 11 ExclusiveArch:  %{java_arches} noarch
 12 
 13 # cvs -d:pserver:anonymous@aopalliance.cvs.sourceforge.net:/cvsroot/aopalliance login
 14 # password empty
 15 # cvs -z3 -d:pserver:anonymous@aopalliance.cvs.sourceforge.net:/cvsroot/aopalliance export -r HEAD aopalliance
 16 Source0:        aopalliance-src.tar.gz
 17 Source1:        http://repo1.maven.org/maven2/aopalliance/aopalliance/1.0/aopalliance-1.0.pom
 18 Source2:        %{name}-MANIFEST.MF
```

We will try commenting out this tag from the aopalliance.spec file.

Change Num 1 before next build try:

Carried out this change:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ diff ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson/output/fedora/specs/aopalliance/aopalliance.spec SPECS-EXTENDED/aopalliance/aopalliance.spec
11c11
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$
```


Carried out the build:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_17_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 500244
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    8m26.756s
user    0m0.010s
sys     0m0.010s
```

Now it failed because the graphpkgfetcher failed to find "apache-commons-beanutils"

```
WARN[0381][graphpkgfetcher] (Cache progress 99%): failed to resolve graph node (perl(XString)(,):<ID:15160 Type:Remote State:Unresolved Rpm:<NO_RPM_PATH>> from '<NO_SRPM_PATH>' in '<NO_SOURCE_REPO>'):
(could not resolve perl(XString)) 
INFO[0381][graphpkgfetcher] Attempting to download delta RPMs for build nodes 
FATA[0382][graphpkgfetcher] Failed to fetch packages:
failed to download delta RPMs:
failed to generate package build list to calculate delta downloads:
failed to find nodes for the packages from the re-built list:
failed to find package (apache-commons-beanutils) in the dependency graph 
INFO[0382][graphpkgfetcher] Waiting for outstanding chroot initialization and cleanup to finish 
```

Investigating this error in the build logs found that the build of this package also failed for the same reason that it cannot be built on current architecture.
We can see that apache-commons-beanutils also has an "ExclusiveArch:" tag in it.

Change Num 1 before next build try:

Therefore, commented that out:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ diff ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson/output/fedora/specs/apache-commons-beanutils/apache-commons-beanutils.spec SPECS-EXTENDED/apache-commons-beanutils/apache-commons-beanutils.spec 
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
```

Are there more such packages listed in the build logs???
Yes, there are 45 such packages:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ grep "srpmpacker.*Skipping.*cannot be built on current architecture" ../bld_binsrch_minus_tommath_17_20241122-1113.log | wc
     45     495    5924
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ grep "srpmpacker.*Skipping.*cannot be built on current architecture" ../bld_binsrch_minus_tommath_17_20241122-1113.log 
INFO[0034][srpmpacker] Skipping (/specs/httpcomponents-core/httpcomponents-core.spec) since it cannot be built on current architecture. 
INFO[0035][srpmpacker] Skipping (/specs/bsf/bsf.spec) since it cannot be built on current architecture. 
INFO[0035][srpmpacker] Skipping (/specs/jdepend/jdepend.spec) since it cannot be built on current architecture. 
INFO[0035][srpmpacker] Skipping (/specs/apache-commons-compress/apache-commons-compress.spec) since it cannot be built on current architecture. 
INFO[0036][srpmpacker] Skipping (/specs/iprutils/iprutils.spec) since it cannot be built on current architecture. 
INFO[0036][srpmpacker] Skipping (/specs/apache-commons-net/apache-commons-net.spec) since it cannot be built on current architecture. 
INFO[0036][srpmpacker] Skipping (/specs/javacc/javacc.spec) since it cannot be built on current architecture. 
INFO[0036][srpmpacker] Skipping (/specs/jtidy/jtidy.spec) since it cannot be built on current architecture. 
INFO[0036][srpmpacker] Skipping (/specs/apache-commons-digester/apache-commons-digester.spec) since it cannot be built on current architecture. 
INFO[0037][srpmpacker] Skipping (/specs/beust-jcommander/beust-jcommander.spec) since it cannot be built on current architecture. 
INFO[0037][srpmpacker] Skipping (/specs/sblim-cim-client2/sblim-cim-client2.spec) since it cannot be built on current architecture. 
INFO[0037][srpmpacker] Skipping (/specs/apache-commons-collections4/apache-commons-collections4.spec) since it cannot be built on current architecture. 
INFO[0038][srpmpacker] Skipping (/specs/xmlunit/xmlunit.spec) since it cannot be built on current architecture. 
INFO[0038][srpmpacker] Skipping (/specs/jsoup/jsoup.spec) since it cannot be built on current architecture. 
INFO[0038][srpmpacker] Skipping (/specs/trilead-ssh2/trilead-ssh2.spec) since it cannot be built on current architecture. 
INFO[0040][srpmpacker] Skipping (/specs/osgi-compendium/osgi-compendium.spec) since it cannot be built on current architecture. 
INFO[0040][srpmpacker] Skipping (/specs/apache-commons-beanutils/apache-commons-beanutils.spec) since it cannot be built on current architecture. 
INFO[0041][srpmpacker] Skipping (/specs/apache-commons-collections/apache-commons-collections.spec) since it cannot be built on current architecture. 
INFO[0041][srpmpacker] Skipping (/specs/ecj/ecj.spec) since it cannot be built on current architecture. 
INFO[0044][srpmpacker] Skipping (/specs/jdom2/jdom2.spec) since it cannot be built on current architecture. 
INFO[0045][srpmpacker] Skipping (/specs/cglib/cglib.spec) since it cannot be built on current architecture. 
INFO[0046][srpmpacker] Skipping (/specs/jline/jline.spec) since it cannot be built on current architecture. 
INFO[0046][srpmpacker] Skipping (/specs/bcel/bcel.spec) since it cannot be built on current architecture. 
INFO[0047][srpmpacker] Skipping (/specs/xalan-j2/xalan-j2.spec) since it cannot be built on current architecture. 
INFO[0047][srpmpacker] Skipping (/specs/apache-commons-codec/apache-commons-codec.spec) since it cannot be built on current architecture. 
INFO[0047][srpmpacker] Skipping (/specs/apache-parent/apache-parent.spec) since it cannot be built on current architecture. 
INFO[0048][srpmpacker] Skipping (/specs/crypto-policies/crypto-policies.spec) since it cannot be built on current architecture. 
INFO[0048][srpmpacker] Skipping (/specs/maven-parent/maven-parent.spec) since it cannot be built on current architecture. 
INFO[0049][srpmpacker] Skipping (/specs/slirp4netns/slirp4netns.spec) since it cannot be built on current architecture. 
INFO[0050][srpmpacker] Skipping (/specs/containernetworking-plugins/containernetworking-plugins.spec) since it cannot be built on current architecture. 
INFO[0051][srpmpacker] Skipping (/specs/regexp/regexp.spec) since it cannot be built on current architecture. 
INFO[0051][srpmpacker] Skipping (/specs/objenesis/objenesis.spec) since it cannot be built on current architecture. 
INFO[0055][srpmpacker] Skipping (/specs/jzlib/jzlib.spec) since it cannot be built on current architecture. 
INFO[0055][srpmpacker] Skipping (/specs/jansi/jansi.spec) since it cannot be built on current architecture. 
INFO[0055][srpmpacker] Skipping (/specs/osgi-core/osgi-core.spec) since it cannot be built on current architecture. 
INFO[0056][srpmpacker] Skipping (/specs/xbean/xbean.spec) since it cannot be built on current architecture. 
INFO[0056][srpmpacker] Skipping (/specs/apache-commons-jexl/apache-commons-jexl.spec) since it cannot be built on current architecture. 
INFO[0056][srpmpacker] Skipping (/specs/plexus-pom/plexus-pom.spec) since it cannot be built on current architecture. 
INFO[0057][srpmpacker] Skipping (/specs/args4j/args4j.spec) since it cannot be built on current architecture. 
INFO[0057][srpmpacker] Skipping (/specs/apache-commons-io/apache-commons-io.spec) since it cannot be built on current architecture. 
INFO[0058][srpmpacker] Skipping (/specs/apache-commons-pool/apache-commons-pool.spec) since it cannot be built on current architecture. 
INFO[0059][srpmpacker] Skipping (/specs/jsch/jsch.spec) since it cannot be built on current architecture. 
INFO[0059][srpmpacker] Skipping (/specs/osgi-annotation/osgi-annotation.spec) since it cannot be built on current architecture. 
INFO[0060][srpmpacker] Skipping (/specs/rhino/rhino.spec) since it cannot be built on current architecture. 
INFO[0060][srpmpacker] Skipping (/specs/xerces-j2/xerces-j2.spec) since it cannot be built on current architecture. 
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ grep "srpmpacker.*Skipping.*cannot be built on current architecture" ../bld_binsrch_minus_tommath_17_20241122-1113.log | wc
     45     495    5924
```


Proceeding to check each spec file for "ExclusiveArch:" tag:

First extracting the error causing specs from the build logs:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ grep "srpmpacker.*Skipping.*cannot be built on current architecture" ../bld_binsrch_minus_tommath_17_20241122-1113.log | sed -e "s/.*Skipping (\/specs\/\(.*\)).*/\1/" |wc
     45      45    1379
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ grep "srpmpacker.*Skipping.*cannot be built on current architecture" ../bld_binsrch_minus_tommath_17_20241122-1113.log | sed -e "s/.*Skipping (\/specs\/\(.*\)).*/\1/"
httpcomponents-core/httpcomponents-core.spec
bsf/bsf.spec
jdepend/jdepend.spec
apache-commons-compress/apache-commons-compress.spec
iprutils/iprutils.spec
apache-commons-net/apache-commons-net.spec
javacc/javacc.spec
jtidy/jtidy.spec
apache-commons-digester/apache-commons-digester.spec
beust-jcommander/beust-jcommander.spec
sblim-cim-client2/sblim-cim-client2.spec
apache-commons-collections4/apache-commons-collections4.spec
xmlunit/xmlunit.spec
jsoup/jsoup.spec
trilead-ssh2/trilead-ssh2.spec
osgi-compendium/osgi-compendium.spec
apache-commons-beanutils/apache-commons-beanutils.spec
apache-commons-collections/apache-commons-collections.spec
ecj/ecj.spec
jdom2/jdom2.spec
cglib/cglib.spec
jline/jline.spec
bcel/bcel.spec
xalan-j2/xalan-j2.spec
apache-commons-codec/apache-commons-codec.spec
apache-parent/apache-parent.spec
crypto-policies/crypto-policies.spec
maven-parent/maven-parent.spec
slirp4netns/slirp4netns.spec
containernetworking-plugins/containernetworking-plugins.spec
regexp/regexp.spec
objenesis/objenesis.spec
jzlib/jzlib.spec
jansi/jansi.spec
osgi-core/osgi-core.spec
xbean/xbean.spec
apache-commons-jexl/apache-commons-jexl.spec
plexus-pom/plexus-pom.spec
args4j/args4j.spec
apache-commons-io/apache-commons-io.spec
apache-commons-pool/apache-commons-pool.spec
jsch/jsch.spec
osgi-annotation/osgi-annotation.spec
rhino/rhino.spec
xerces-j2/xerces-j2.spec
```

The checking if all these spec files use "ExclusiveArch:" tag or not:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ pkg_w_arch_issue=`grep "srpmpacker.*Skipping.*cannot be built on current architecture" ../bld_binsrch_minus_tommath_17_202411
22-1113.log | sed -e "s/.*Skipping (\/specs\/\(.*\)).*/\1/"`
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ echo $pkg_w_arch_issue
httpcomponents-core/httpcomponents-core.spec bsf/bsf.spec jdepend/jdepend.spec apache-commons-compress/apache-commons-compress.spec iprutils/iprutils.spec apache-commons-net/apache-commons-net.spec javacc/javacc.spec jtidy/jtidy.spec apache-commons-digester/apache-commons-digester.spec beust-jcommander/beust-jcommander.spec sblim-cim-client2/sblim-cim-client2.spec apache-commons-collections4/apache-commons-collections4.spec xmlunit/xmlunit.spec jsoup/jsoup.spec trilead-ssh2/trilead-ssh2.spec osgi-compendium/osgi-compendium.spec apache-commons-beanutils/apache-commons-beanutils.spec apache-commons-collections/apache-commons-collections.spec ecj/ecj.spec jdom2/jdom2.spec cglib/cglib.spec jline/jline.spec bcel/bcel.spec xalan-j2/xalan-j2.spec apache-commons-codec/apache-commons-codec.spec apache-parent/apache-parent.spec crypto-policies/crypto-policies.spec maven-parent/maven-parent.spec slirp4netns/slirp4netns.spec containernetworking-plugins/containernetworking-plugins.spec regexp/regexp.spec objenesis/objenesis.spec jzlib/jzlib.spec jansi/jansi.spec osgi-core/osgi-core.spec xbean/xbean.spec apache-commons-jexl/apache-commons-jexl.spec plexus-pom/plexus-pom.spec args4j/args4j.spec apache-commons-io/apache-commons-io.spec apache-commons-pool/apache-commons-pool.spec jsch/jsch.spec osgi-annotation/osgi-annotation.spec rhino/rhino.spec xerces-j2/xerces-j2.spec
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
```

Yes, all of these use the "ExclusiveArch" tag:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ for pkg in `echo $pkg_w_arch_issue`; do  grep "ExclusiveArch:" ../SPECS-EXTENDED/$pkg > /dev/null; foundflag=$?; if [ $foundflag -eq 0 ]; then  echo $pkg " uses the ExclusiveArch: tag"; else echo $pkg " doesn't use the ExclusiveArch: tag"; fi; done | grep "uses" | wc
     45     225    2684
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ for pkg in `echo $pkg_w_arch_issue`; do  grep "ExclusiveArch:" ../SPECS-EXTENDED/$pkg > /dev/null; foundflag=$?; if [ $foundflag -eq 0 ]; then  echo $pkg " uses the ExclusiveArch: tag"; else echo $pkg " doesn't use the ExclusiveArch: tag"; fi; done | grep "doesnt use" | wc
      0       0       0
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ for pkg in `echo $pkg_w_arch_issue`; do  grep "ExclusiveArch:" ../SPECS-EXTENDED/$pkg > /dev/null; foundflag=$?; if [ $foundflag -eq 0 ]; then  echo $pkg " uses the ExclusiveArch: tag"; else echo $pkg " doesn't use the ExclusiveArch: tag"; fi; done 
httpcomponents-core/httpcomponents-core.spec  uses the ExclusiveArch: tag
bsf/bsf.spec  uses the ExclusiveArch: tag
jdepend/jdepend.spec  uses the ExclusiveArch: tag
apache-commons-compress/apache-commons-compress.spec  uses the ExclusiveArch: tag
iprutils/iprutils.spec  uses the ExclusiveArch: tag
apache-commons-net/apache-commons-net.spec  uses the ExclusiveArch: tag
javacc/javacc.spec  uses the ExclusiveArch: tag
jtidy/jtidy.spec  uses the ExclusiveArch: tag
apache-commons-digester/apache-commons-digester.spec  uses the ExclusiveArch: tag
beust-jcommander/beust-jcommander.spec  uses the ExclusiveArch: tag
sblim-cim-client2/sblim-cim-client2.spec  uses the ExclusiveArch: tag
apache-commons-collections4/apache-commons-collections4.spec  uses the ExclusiveArch: tag
xmlunit/xmlunit.spec  uses the ExclusiveArch: tag
jsoup/jsoup.spec  uses the ExclusiveArch: tag
trilead-ssh2/trilead-ssh2.spec  uses the ExclusiveArch: tag
osgi-compendium/osgi-compendium.spec  uses the ExclusiveArch: tag
apache-commons-beanutils/apache-commons-beanutils.spec  uses the ExclusiveArch: tag
apache-commons-collections/apache-commons-collections.spec  uses the ExclusiveArch: tag
ecj/ecj.spec  uses the ExclusiveArch: tag
jdom2/jdom2.spec  uses the ExclusiveArch: tag
cglib/cglib.spec  uses the ExclusiveArch: tag
jline/jline.spec  uses the ExclusiveArch: tag
bcel/bcel.spec  uses the ExclusiveArch: tag
xalan-j2/xalan-j2.spec  uses the ExclusiveArch: tag
apache-commons-codec/apache-commons-codec.spec  uses the ExclusiveArch: tag
apache-parent/apache-parent.spec  uses the ExclusiveArch: tag
crypto-policies/crypto-policies.spec  uses the ExclusiveArch: tag
maven-parent/maven-parent.spec  uses the ExclusiveArch: tag
slirp4netns/slirp4netns.spec  uses the ExclusiveArch: tag
containernetworking-plugins/containernetworking-plugins.spec  uses the ExclusiveArch: tag
regexp/regexp.spec  uses the ExclusiveArch: tag
objenesis/objenesis.spec  uses the ExclusiveArch: tag
jzlib/jzlib.spec  uses the ExclusiveArch: tag
jansi/jansi.spec  uses the ExclusiveArch: tag
osgi-core/osgi-core.spec  uses the ExclusiveArch: tag
xbean/xbean.spec  uses the ExclusiveArch: tag
apache-commons-jexl/apache-commons-jexl.spec  uses the ExclusiveArch: tag
plexus-pom/plexus-pom.spec  uses the ExclusiveArch: tag
args4j/args4j.spec  uses the ExclusiveArch: tag
apache-commons-io/apache-commons-io.spec  uses the ExclusiveArch: tag
apache-commons-pool/apache-commons-pool.spec  uses the ExclusiveArch: tag
jsch/jsch.spec  uses the ExclusiveArch: tag
osgi-annotation/osgi-annotation.spec  uses the ExclusiveArch: tag
rhino/rhino.spec  uses the ExclusiveArch: tag
xerces-j2/xerces-j2.spec  uses the ExclusiveArch: tag
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
```

Carried out the commenting of this line:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ for fil in `echo $pkg_w_arch_issue`
> do
> echo $fil " being modified"
> cat $fil | awk '/^ExclusiveArch:/ {print "#"$0} !/^ExclusiveArch:/ {print $0}' > temporaryfile 
> mv temporaryfile $fil
> done
httpcomponents-core/httpcomponents-core.spec  being modified
bsf/bsf.spec  being modified
jdepend/jdepend.spec  being modified
apache-commons-compress/apache-commons-compress.spec  being modified
iprutils/iprutils.spec  being modified
apache-commons-net/apache-commons-net.spec  being modified
javacc/javacc.spec  being modified
jtidy/jtidy.spec  being modified
apache-commons-digester/apache-commons-digester.spec  being modified
beust-jcommander/beust-jcommander.spec  being modified
sblim-cim-client2/sblim-cim-client2.spec  being modified
apache-commons-collections4/apache-commons-collections4.spec  being modified
xmlunit/xmlunit.spec  being modified
jsoup/jsoup.spec  being modified
trilead-ssh2/trilead-ssh2.spec  being modified
osgi-compendium/osgi-compendium.spec  being modified
apache-commons-beanutils/apache-commons-beanutils.spec  being modified
apache-commons-collections/apache-commons-collections.spec  being modified
ecj/ecj.spec  being modified
jdom2/jdom2.spec  being modified
cglib/cglib.spec  being modified
jline/jline.spec  being modified
bcel/bcel.spec  being modified
xalan-j2/xalan-j2.spec  being modified
apache-commons-codec/apache-commons-codec.spec  being modified
apache-parent/apache-parent.spec  being modified
crypto-policies/crypto-policies.spec  being modified
maven-parent/maven-parent.spec  being modified
slirp4netns/slirp4netns.spec  being modified
containernetworking-plugins/containernetworking-plugins.spec  being modified
regexp/regexp.spec  being modified
objenesis/objenesis.spec  being modified
jzlib/jzlib.spec  being modified
jansi/jansi.spec  being modified
osgi-core/osgi-core.spec  being modified
xbean/xbean.spec  being modified
apache-commons-jexl/apache-commons-jexl.spec  being modified
plexus-pom/plexus-pom.spec  being modified
args4j/args4j.spec  being modified
apache-commons-io/apache-commons-io.spec  being modified
apache-commons-pool/apache-commons-pool.spec  being modified
jsch/jsch.spec  being modified
osgi-annotation/osgi-annotation.spec  being modified
rhino/rhino.spec  being modified
xerces-j2/xerces-j2.spec  being modified
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ 
```

Verifying that all the files were changed correctly:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ for fil in `echo $pkg_w_arch_issue`
> do
> echo $fil
> diff ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson/output/fedora/specs/$fil ./$fil
> done
httpcomponents-core/httpcomponents-core.spec
14c14
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
bsf/bsf.spec
8c8
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
jdepend/jdepend.spec
8c8
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
apache-commons-compress/apache-commons-compress.spec
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
iprutils/iprutils.spec
16c16
< ExclusiveArch: ppc64le
---
> #ExclusiveArch: ppc64le
apache-commons-net/apache-commons-net.spec
11c11
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
javacc/javacc.spec
68c68
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
jtidy/jtidy.spec
16c16
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
apache-commons-digester/apache-commons-digester.spec
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
beust-jcommander/beust-jcommander.spec
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
sblim-cim-client2/sblim-cim-client2.spec
16c16
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
apache-commons-collections4/apache-commons-collections4.spec
11c11
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
xmlunit/xmlunit.spec
11c11
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
jsoup/jsoup.spec
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
trilead-ssh2/trilead-ssh2.spec
32c32
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
osgi-compendium/osgi-compendium.spec
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
apache-commons-beanutils/apache-commons-beanutils.spec
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
apache-commons-collections/apache-commons-collections.spec
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
ecj/ecj.spec
25c25
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
jdom2/jdom2.spec
29c29
< ExclusiveArch: %{java_arches} noarch
---
> #ExclusiveArch: %{java_arches} noarch
cglib/cglib.spec
14c14
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
jline/jline.spec
25c25
< ExclusiveArch:  %{java_arches}
---
> #ExclusiveArch:  %{java_arches}
bcel/bcel.spec
8c8
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
xalan-j2/xalan-j2.spec
22c22
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
apache-commons-codec/apache-commons-codec.spec
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
apache-parent/apache-parent.spec
11c11
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
crypto-policies/crypto-policies.spec
22c22
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
maven-parent/maven-parent.spec
11c11
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
slirp4netns/slirp4netns.spec
19c19
< ExclusiveArch: %{golang_arches_future}
---
> #ExclusiveArch: %{golang_arches_future}
containernetworking-plugins/containernetworking-plugins.spec
39c39
< ExclusiveArch: %{golang_arches}
---
> #ExclusiveArch: %{golang_arches}
regexp/regexp.spec
9c9
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
objenesis/objenesis.spec
40c40
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
jzlib/jzlib.spec
8c8
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
jansi/jansi.spec
9c9
< ExclusiveArch:    %{java_arches}
---
> #ExclusiveArch:    %{java_arches}
osgi-core/osgi-core.spec
14c14
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
xbean/xbean.spec
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
apache-commons-jexl/apache-commons-jexl.spec
22c22
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
plexus-pom/plexus-pom.spec
12c12
< ExclusiveArch: %{java_arches} noarch
---
> #ExclusiveArch: %{java_arches} noarch
args4j/args4j.spec
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
apache-commons-io/apache-commons-io.spec
11c11
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
apache-commons-pool/apache-commons-pool.spec
8c8
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
jsch/jsch.spec
8c8
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
osgi-annotation/osgi-annotation.spec
10c10
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
rhino/rhino.spec
17c17
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
xerces-j2/xerces-j2.spec
36c36
< ExclusiveArch: %{java_arches} noarch
---
> #ExclusiveArch: %{java_arches} noarch
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ 
```

Started another build:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_18_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 631057
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    2m11.247s
user    0m0.008s
sys     0m0.012s
```

The build failed in 2 minutes.
The error was circular dependency found for "javacc-0:7.0.13-7.azl3-" by grapher.

```
INFO[0001][grapher] Adding unresolved node (perl(IO::Tty)--REMOTE<Unresolved>) 
INFO[0001][grapher] Adding unresolved node (perl(Software::License)--REMOTE<Unresolved>) 
INFO[0001][grapher]     Added 95493 dependencies                    
INFO[0001][grapher] Running cycle resolution to fix any cycles in the dependency graph 
INFO[0002][grapher] Trying to fix circular dependency found:    {javacc-0:7.0.13-7.azl3-BUILD<Build>} --> {javacc-0:7.0.13-7.azl3-RUN<Meta>} 
WARN[0002][grapher] â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— 
WARN[0002][grapher] â•‘  'copy-toolchain-rpms' should no longer be required to resolve cycles even when using online  â•‘ 
WARN[0002][grapher] â•‘ toolchain rpms. If you see this message, there is likely a legitimate cycle in the dependency â•‘ 
WARN[0002][grapher] â•‘                                            graph.                                             â•‘ 
WARN[0002][grapher] â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 
PANI[0002][grapher] unfixable circular dependency in dependency graph ({javacc-0:7.0.13-7.azl3-RUN<Meta>} --> {javacc-0:7.0.13-7.azl3-BUILD<Build>} --> {javacc-0:7.0.13-7.azl3-RUN<Meta>}):
cycle can't be resolved with prebuilt/PMC RPMs. Unresolvable 
panic: (*logrus.Entry) 0xc002423030

goroutine 1 [running]:
```

Found that javacc.spec had a BuildRequires on javacc itself:

```

%if %{with bootstrap}
BuildRequires:  javapackages-bootstrap
%else
BuildRequires:  javapackages-local
BuildRequires:  ant
BuildRequires:  javacc
%endif
```


Change Num 1 before next build try:
We will comment out this BuildRequires.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ diff ~/utils/AZL_StandardTools/IMPORT_SPECS_MDFY_CGMJ/import_specs_modify_cgmjson/output/fedora/specs/javacc/javacc.sp
ec javacc/javacc.spec 
60c60
< BuildRequires:  javacc
---
> #BuildRequires:  javacc
68c68
< ExclusiveArch:  %{java_arches} noarch
---
> #ExclusiveArch:  %{java_arches} noarch
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED ]$ 
```

Lets build again:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_19_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 753176
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    10m33.263s
user    0m0.006s
sys     0m0.013s
```

Again it failed.
The reason was that the graphpkgfetcher couldn't find baekmuk-ttf-fonts

```
INFO[0476][graphpkgfetcher] Attempting to download delta RPMs for build nodes 
FATA[0477][graphpkgfetcher] Failed to fetch packages:
failed to download delta RPMs:
failed to generate package build list to calculate delta downloads:
failed to find nodes for the packages from the re-built list:
failed to find package (baekmuk-ttf-fonts) in the dependency graph 
INFO[0477][graphpkgfetcher] Waiting for outstanding chroot initialization and cleanup to finish 
INFO[0477][graphpkgfetcher] Waiting for outstanding chroot commands to finish 
```

Repeated build, hoping that somehow the error will go away on its own:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_20_$(date +%Y%m%d-%H%M).log 2>&1 &
[2] 884947
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
real    8m4.112s
user    0m0.006s
sys     0m0.011s
```

But it didn't, and the same error happened:

```
INFO[0419][graphpkgfetcher] (Cache progress 99%): choosing (libXdmcp-devel-1.1.4-1.azl3.x86_64.rpm) to provide (libXdmcp-devel) 
INFO[0419][graphpkgfetcher] Attempting to download delta RPMs for build nodes 
FATA[0420][graphpkgfetcher] Failed to fetch packages:
failed to download delta RPMs:
failed to generate package build list to calculate delta downloads:
failed to find nodes for the packages from the re-built list:
failed to find package (baekmuk-ttf-fonts) in the dependency graph 
INFO[0420][graphpkgfetcher] Waiting for outstanding chroot initialization and cleanup to finish 
INFO[0420][graphpkgfetcher] Waiting for outstanding chroot commands to finish 
INFO[0420][graphpkgfetcher] Waiting for outstanding processes to be created before blocking all future processes 
INFO[0420][graphpkgfetcher] Waiting for outstanding processes to be created before stopping all child processes 
INFO[0420][graphpkgfetcher] Cleaning up all active chroots               
```

My understanding is that baekmuk-ttf-fonts related build issues reported by the tool "srpmpacker" yesterday got fixed when 
we replaced the fontpkgname1, fontpkgname2, etc by the names of actual files.

The first build after this fix was the one which had the pid of "357964" and the log file generated was "bld_binsrch_minus_tommath_3_*.log"

Then in the build last build of yesterday, i.e. 21 Nov, was run with a "make clean", and had generated the file "../bld_binsrch_minus_tommath_10*.log".
This build has no mention of an error around "baekmuk-ttf-font".  As well as there is a "baekmuk-ttf-fonts-2.2-63.azl3.src.rpm" present in i
"build/INTERMEDIATE-SRPMS", with a time stamp of 18:15, 21 Nov, which is UTC, i.e. 18:15 + 05:30 i.e. 01:45 of 22 Nov IST.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build ]$ ls -ls ./INTERMEDIATE_SRPMS/baekmuk-ttf-fonts-2.2-63.azl3.src.rpm ./INTERMEDIATE_SRPMS/aopalliance-1.0-40.azl3.src.rpm
   32 -rw-r--r--. 1 root root    32613 Nov 22 11:14 ./INTERMEDIATE_SRPMS/aopalliance-1.0-40.azl3.src.rpm
28592 -rw-r--r--. 1 root root 29275920 Nov 21 18:15 ./INTERMEDIATE_SRPMS/baekmuk-ttf-fonts-2.2-63.azl3.src.rpm
```

This means that srpmpacker had successfully generated baekmuk-ttf-fonts and placed it in INTERMEDIATE_SRPMS.  
Today's builds have proceeded without any make clean.
So, the error thrown by graphpkgfetcher that it could not find baekmuk-ttf-fonts in the dependency graph is not clear to me.

Therefore, when graphpackagefetcher says that it could not find baekmuk-ttf-fonts in the dependency graph means that the 
graph.dot provided to it as input is not correct.

We have verified the same by running the depsearch tools also:
```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ go run depsearch.go --input=../../../build/pkg_artifacts/graph.dot --specs=baekmuk-ttf-fonts 
WARN[0000][depsearch] Default toolchain filter file (./resources/manifests/package/toolchain_x86_64.txt) not found, setting to '' 
INFO[0000][depsearch] Filter file () not applicable here           
INFO[0000][depsearch] Reading DOT graph from ../../../build/pkg_artifacts/graph.dot 
PANI[0001][depsearch] failed to find nodes matching pkgs:([]) or specs:([baekmuk-ttf-fonts]) or goals:([]) 
panic: (*logrus.Entry) 0xc00031a070

goroutine 1 [running]:
github.com/sirupsen/logrus.(*Entry).log(0xc00031a000, 0x0, {0xc0000fa900, 0x54})
        /home/neerajs/go/pkg/mod/github.com/sirupsen/logrus@v1.9.3/entry.go:260 +0x485
github.com/sirupsen/logrus.(*Entry).Log(0xc00031a000, 0x0, {0xc009d1bd70?, 0x52da10?, 0xc000314940?})
        /home/neerajs/go/pkg/mod/github.com/sirupsen/logrus@v1.9.3/entry.go:304 +0x48
github.com/sirupsen/logrus.(*Entry).Logln(0xc00031a000, 0x0, {0xc009d1be08?, 0x83c620?, 0x0?})
        /home/neerajs/go/pkg/mod/github.com/sirupsen/logrus@v1.9.3/entry.go:394 +0x7f
github.com/sirupsen/logrus.(*Logger).Logln(0xc000314900, 0x0, {0xc009d1be08, 0x1, 0x1})
        /home/neerajs/go/pkg/mod/github.com/sirupsen/logrus@v1.9.3/logger.go:298 +0x58
github.com/sirupsen/logrus.(*Logger).Panicln(...)
        /home/neerajs/go/pkg/mod/github.com/sirupsen/logrus@v1.9.3/logger.go:339
github.com/microsoft/azurelinux/toolkit/tools/internal/logger.PanicOnError({0x839c20?, 0xc0014add10?}, {0x0?, 0x0?, 0x0?})
        /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/internal/logger/log.go:162 +0xb7
main.main()
        /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch/depsearch.go:83 +0x4b0
exit status 2
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit/tools/depsearch ]$ go run depsearch.go --input=../../../build/pkg_artifacts/graph.dot --specs=aopalliance
WARN[0000][depsearch] Default toolchain filter file (./resources/manifests/package/toolchain_x86_64.txt) not found, setting to '' 
INFO[0000][depsearch] Filter file () not applicable here           
INFO[0000][depsearch] Reading DOT graph from ../../../build/pkg_artifacts/graph.dot 
INFO[0001][depsearch] Found 1 nodes to consider                    
INFO[0001][depsearch] Forward search will list all dependants which rely on any of the provided packages 
INFO[0002][depsearch] Scanned 0 nodes                              
aopalliance
```


The link
https://github.com/microsoft/azurelinux/blob/3.0/toolkit/docs/how_it_works/3_package_building.md#stage-2-graphpkgfetcher

says the following:

```
The graphpkgfetcher tool's job is to resolve unresolved remote nodes. Unresolved nodes occur when a local package has Requires or BuildRequires which are not available from another local package.

The tool uses the worker_chroot (see Chroot Worker) to locate packages. The worker will search in five locations:

the local chroot environment,
already built RPMs in ./../out/RPMS/,
the upstream base repository,
the upstream preview repository if $(USE_PREVIEW_REPO) is set to y, and
any remote repo listed in REPO_LIST ?=.
```

Therefore, let's try if downloading baekmuk-ttf-fonts and placing it in rpm_cache/cache will resolve the issue:
We downloaded "baekmuk-ttf-fonts-common-2.2-52.cm2.noarch.rpm".
But it does not provide "baekmuk-ttf-fonts".


```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ ls | grep baekmuk
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ ls | grep baekmuk
baekmuk-ttf-fonts-common-2.2-52.cm2.noarch.rpm
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ rpm -qp --provides baekmuk-ttf-fonts-common-2.2-52.cm2.noarch.rpm 
baekmuk-ttf-common-fonts = 2.2-52.cm2
baekmuk-ttf-fonts-common = 2.2-52.cm2
baekmuk-ttf-fonts-ghostscript = 2.2-52.cm2
fonts-korean = 2.2-52.cm2
metainfo()
metainfo(baekmuk-ttf.metainfo.xml)
ttfonts-ko = 2.2-52.cm2
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/build/rpm_cache/cache ]$ 
```

Therefore, started looking into the baekmuk-ttf-fonts.spec file to know about the tar.gz name.
Looking into the things I realized that the downloaded baekmuk-ttf-fonts.spec file and the one present in Mariner 3.0-dev, both have version as 2.2.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ grep -e "^Version:" SPECS-EXTENDED/baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec
Version: 2.2
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ grep -e "^Version:" SavedMarinerPkg_ORIGINALS/baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec 
Version:        2.2
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms ]$ 
```

Then why should we change anything for this package.
Lets restore the 3.0-dev version of the directory for this package.

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED/baekmuk-ttf-fonts ]$ git status .
On branch topic_bbld_16Nov
Changes not staged for commit:
  (use "git add/rm <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        deleted:    baekmuk-ttf-batang.conf
        deleted:    baekmuk-ttf-batang.metainfo.xml
        deleted:    baekmuk-ttf-dotum.conf
        deleted:    baekmuk-ttf-dotum.metainfo.xml
        modified:   baekmuk-ttf-fonts.signatures.json
        modified:   baekmuk-ttf-fonts.spec
        deleted:    baekmuk-ttf-gulim.conf
        deleted:    baekmuk-ttf-gulim.metainfo.xml
        deleted:    baekmuk-ttf-hline.conf
        deleted:    baekmuk-ttf-hline.metainfo.xml
        deleted:    baekmuk-ttf.metainfo.xml

Untracked files:
  (use "git add <file>..." to include in what will be committed)
        68-baekmuk-batang-fonts.conf
        68-baekmuk-dotum-fonts.conf
        68-baekmuk-gulim-fonts.conf
        68-baekmuk-headline-fonts.conf

no changes added to commit (use "git add" and/or "git commit -a")
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED/baekmuk-ttf-fonts ]$ git checkout .
Updated 11 paths from the index
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED/baekmuk-ttf-fonts ]$ git status .
On branch topic_bbld_16Nov
Untracked files:
  (use "git add <file>..." to include in what will be committed)
        68-baekmuk-batang-fonts.conf
        68-baekmuk-dotum-fonts.conf
        68-baekmuk-gulim-fonts.conf
        68-baekmuk-headline-fonts.conf

nothing added to commit but untracked files present (use "git add" to track)
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED/baekmuk-ttf-fonts ]$ rm 68-baekmuk-batang-fonts.conf 68-baekmuk-dotum-fonts.conf 68-baekmuk-gulim-fonts.conf 68-baekmuk-headline-fonts.conf
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED/baekmuk-ttf-fonts ]$ git status .
On branch topic_bbld_16Nov
nothing to commit, working tree clean
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/SPECS-EXTENDED/baekmuk-ttf-fonts ]$ 
```

Lets try after doing a make clean now.


Started the build after a reboot and make clean:

```
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ history | tail -20
  988  vim SPECS-EXTENDED/aopalliance/aopalliance.spec 
  989  vim SPECS-EXTENDED/baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec 
  990  grep -e "^Version:" SPECS-EXTENDED/baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec
  991  grep -e "^Version:" SavedMarinerPkg_ORIGINALS/baekmuk-ttf-fonts/baekmuk-ttf-fonts.spec 
  992  cd SPECS-EXTENDED/
  993  cd baekmuk-ttf-fonts/
  994  git status .
  995  git checkout .
  996  git status .
  997  rm 68-baekmuk-batang-fonts.conf 68-baekmuk-dotum-fonts.conf 68-baekmuk-gulim-fonts.conf 68-baekmuk-headline-fonts.conf
  998  git status .
  999  cd /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/
 1000  sudo ls
 1001  sudo make clean
 1002  cd toolkit
 1003  sudo make clean
 1004  ls -lrt bld*
 1005  ls -lrt ../bld*
 1006  i#time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_21_$(date +%Y%m%d-%H%M).log 2>&1 &
 1007  history | tail -20
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ time ./binsrch_multitrgt.sh > ../bld_binsrch_minus_tommath_21_$(date +%Y%m%d-%H%M).log 2>&1 &
[1] 8072
neerajs@azuli-m1 [ /sec_disk/bulkbld_16Nov/REPOS/NeerajAZL/azlinux_sms/toolkit ]$ 
```


